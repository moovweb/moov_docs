<body>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-headerset-HeaderSet.html">HeaderSet</a><ul class='methods'><li data-type='method'><a href="module-headerset-HeaderSet.html#addHeader">addHeader</a></li><li data-type='method'><a href="module-headerset-HeaderSet.html#header">header</a></li><li data-type='method'><a href="module-headerset-HeaderSet.html#removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module-headerset-HeaderSet.html#removeHeader">removeHeader</a></li><li data-type='method'><a href="module-headerset-HeaderSet.html#toString">toString</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-functions.html">functions</a><ul class='methods'><li data-type='method'><a href="module-functions.html#.absolutize">absolutize</a></li><li data-type='method'><a href="module-functions.html#.absolutizeSrcs">absolutizeSrcs</a></li><li data-type='method'><a href="module-functions.html#.activeLayers">activeLayers</a></li><li data-type='method'><a href="module-functions.html#.addAssets">addAssets</a></li><li data-type='method'><a href="module-functions.html#.addCanonicalTag">addCanonicalTag</a></li><li data-type='method'><a href="module-functions.html#.assert">assert</a></li><li data-type='method'><a href="module-functions.html#.asset">asset</a></li><li data-type='method'><a href="module-functions.html#.cleanMobileMetaTags">cleanMobileMetaTags</a></li><li data-type='method'><a href="module-functions.html#.getPageType">getPageType</a></li><li data-type='method'><a href="module-functions.html#.handleRobots">handleRobots</a></li><li data-type='method'><a href="module-functions.html#.insertDnsPrefetch">insertDnsPrefetch</a></li><li data-type='method'><a href="module-functions.html#.insertSubresource">insertSubresource</a></li><li data-type='method'><a href="module-functions.html#.isRobots">isRobots</a></li><li data-type='method'><a href="module-functions.html#.layer">layer</a></li><li data-type='method'><a href="module-functions.html#.layerNot">layerNot</a></li><li data-type='method'><a href="module-functions.html#.moveStylesAboveScripts">moveStylesAboveScripts</a></li><li data-type='method'><a href="module-functions.html#.moveStylesToHead">moveStylesToHead</a></li><li data-type='method'><a href="module-functions.html#.onDevelopment">onDevelopment</a></li><li data-type='method'><a href="module-functions.html#.perfectProxy">perfectProxy</a></li><li data-type='method'><a href="module-functions.html#.queryLayerText">queryLayerText</a></li><li data-type='method'><a href="module-functions.html#.relocateScripts">relocateScripts</a></li><li data-type='method'><a href="module-functions.html#.removeAllStyles">removeAllStyles</a></li><li data-type='method'><a href="module-functions.html#.removeDesktopJs">removeDesktopJs</a></li><li data-type='method'><a href="module-functions.html#.removeDesktopMobileIcon">removeDesktopMobileIcon</a></li><li data-type='method'><a href="module-functions.html#.removeHtmlComments">removeHtmlComments</a></li><li data-type='method'><a href="module-functions.html#.rewriteAspNetScripts">rewriteAspNetScripts</a></li><li data-type='method'><a href="module-functions.html#.rewriteJsSrcs">rewriteJsSrcs</a></li><li data-type='method'><a href="module-functions.html#.rewriteLink">rewriteLink</a></li><li data-type='method'><a href="module-functions.html#.rewriteLinks">rewriteLinks</a></li><li data-type='method'><a href="module-functions.html#.rewriteToProxy">rewriteToProxy</a></li><li data-type='method'><a href="module-functions.html#.sass">sass</a></li><li data-type='method'><a href="module-functions.html#.setPageType">setPageType</a></li><li data-type='method'><a href="module-functions.html#~gatherHosts">gatherHosts</a></li></ul></li><li><a href="module-headerset.html">headerset</a></li><li><a href="module-stdlib.html">stdlib</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-headerset-HeaderSet_fns.html">fns</a><ul class='methods'><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.addHeader">addHeader</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.header">header</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.method">method</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.method">method</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.path">path</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.path">path</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.removeHeader">removeHeader</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.statusCode">statusCode</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.statusCode">statusCode</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.statusText">statusText</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.statusText">statusText</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.versionMinor">versionMinor</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.versionMinor">versionMinor</a></li></ul></li><li><a href="module-stdlib-stdlib.html">stdlib</a><ul class='methods'><li data-type='method'><a href="module-stdlib-stdlib.html#.addCookie">addCookie</a></li><li data-type='method'><a href="module-stdlib-stdlib.html#.export">export</a></li><li data-type='method'><a href="module-stdlib-stdlib.html#.init$">init$</a></li><li data-type='method'><a href="module-stdlib-stdlib.html#.scoped$">scoped$</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#breakpoint">breakpoint</a></li><li><a href="global.html#env">env</a></li><li><a href="global.html#layers">layers</a></li><li><a href="global.html#rules">rules</a></li><li><a href="global.html#tag">tag</a></li><li><a href="global.html#txt">txt</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">headerset.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

/**
 * @module headerset
 */

const REQ_REGEX = /^([A-Z]+)\s+(.+)\s+HTTP\/1.([01])$/m;
const RES_REGEX = /^HTTP\/1.([01]) (\d{3}) ([^\n\r]+)$/m;

/**
 * @param {string} type "request" or "response".
 * @param {string} rawHeaders
 * @class
 */
function HeaderSet(type, rawHeaders) {
    this.type = type;
    this.fields = [];
    this.hlookup = {};
    let matches;
    if (type === "request") {
        matches = rawHeaders.match(REQ_REGEX);
        this.method = matches[1];
        this.path = matches[2];
        this.versionMinor = matches[3];
    } else if (type === "response") {
        matches = rawHeaders.match(RES_REGEX);
        this.versionMinor = matches[1];
        this.statusCode = matches[2];
        this.statusText = matches[3];
    }

    let headerExp = /^([^:\s]*): *(.*)$/mg; // local since it contains unique state
    headerExp.lastIndex = matches[0].length;
    while ((matches = headerExp.exec(rawHeaders))) {
        this.hlookup[matches[1].toLowerCase()] = this.fields.length;
        this.fields.push([matches[1], matches[2]]);
    }

    let self = this;

    /**
     * @namespace
     */
    this.fns = {
        /**
         * Get method.
         * @function
         * @returns {string} Return self.method.
         */
        get method() {
            return self.method;
        },
        /**
         * Get path.
         * @function
         * @returns {string} Return self.path.
         */
        get path() {
            return self.path;
        },
        /**
         * Get versionMinor.
         * @function
         * @returns {string} Return self.versionMinor.
         */
        get versionMinor() {
            return self.versionMinor;
        },
        /**
         * Get statusCode.
         * @function
         * @returns {string} Return self.statusCode.
         */
        get statusCode() {
            return self.statusCode;
        },
        /**
         * Get statusText.
         * @function
         * @return {string} Return self.statusText.
         */
        get statusText() {
            return self.statusText;
        },
        /**
         * Set method(val).
         * @function
         * @param {string} val Method.
         */
        set method(val) {
            self.method = val;
        },
        /**
         * Set path(val).
         * @function
         * @param {string} val Path.
         */
        set path(val) {
            self.path = val;
        },
        /**
         * Set versionMinor(val).
         * @function
         * @param {string} val VersionMinor.
         */
        set versionMinor(val) {
            self.versionMinor = val;
        },
        /**
         * Set statusCode(val).
         * @function
         * @param {string} val StatusCode.
         */
        set statusCode(val) {
            self.statusCode = val;
        },
        /**
         * Set statusText(val).
         * @function
         * @param {string} val StatusText.
         */
        set statusText(val) {
            self.statusText = val;
        },

        /**
         * Bind header function.
         * @function
         */
        header: this.header.bind(this),
        /**
         * Bind addHeader function.
         * @function
         */
        addHeader: this.addHeader.bind(this),
        /**
         * Bind removeHeader function.
         * @function
         */
        removeHeader: this.removeHeader.bind(this),
        /**
         * Bind removeAllHeaders function.
         * @function
         */
        removeAllHeaders: this.removeAllHeaders.bind(this)
    };
}
// set or replace existing header
/**
 * Set or replace existing header.
 * @param {string} key Header key.
 * @param {string} val Header value.
 */
HeaderSet.prototype.header = function(key, val) {
    let k = key.toLowerCase();
    if (val) {
        if (k in this.hlookup) {
            this.fields[this.hlookup[k]][1] = val;
        } else {
            this.addHeader(key, val);
        }
    } else {
        return (this.fields[this.hlookup[k]] || [])[1];
    }
};
// append header
/**
 * Append header.
 * @param {string} key Header key.
 * @param {string} val Header value.
 */
HeaderSet.prototype.addHeader = function(key, val) {
    this.hlookup[key.toLowerCase()] = this.fields.length;
    this.fields.push([key, val]);
};
// remove last matching header
/**
 * Remove last matching header.
 * @param {string} key Header key.
 */
HeaderSet.prototype.removeHeader = function(key) {
    key = key.toLowerCase();
    this.fields[this.hlookup[key]] = [];
    delete this.hlookup[key];
};
// remove all matching headers
/**
 * Remove all matching header.
 * @param {string} key Header key.
 */
HeaderSet.prototype.removeAllHeaders = function(key) {
    key = key.toLowerCase();
    for (let i = 0, len = this.fields.length; i &lt; len; i++) {
        if (this.fields[i][0]) {
            let k = this.fields[i][0];
            if (k &amp;&amp; k.toLowerCase() === key) {
                this.fields[i] = [];
            }
        }
    }
    delete this.hlookup[key];
};
/**
 * Print headers as a string.
 * @returns {string} Print headers .
 */
HeaderSet.prototype.toString = function() {
    let raw;
    if (this.type === "request") {
        raw = this.method + " " + this.path + " HTTP/1." + this.versionMinor;
    } else if (this.type === "response") {
        raw = "HTTP/1." + this.versionMinor + " " + this.statusCode + " " + this.statusText;
    }
    for (let i = 0, len = this.fields.length; i &lt; len; i++) {
        if (this.fields[i][0]) {
            raw += "\r\n" + this.fields[i][0] + ": " + this.fields[i][1];
        }
    }
    return raw;
};

// Define all the export points
/**
 * Define all the export points
 */
module.exports = HeaderSet;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Wed Oct 07 2015 14:26:33 GMT-0700 (PDT)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
