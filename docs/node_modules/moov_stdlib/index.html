<body>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-headerset-HeaderSet.html">HeaderSet</a><ul class='methods'><li data-type='method'><a href="module-headerset-HeaderSet.html#addHeader">addHeader</a></li><li data-type='method'><a href="module-headerset-HeaderSet.html#header">header</a></li><li data-type='method'><a href="module-headerset-HeaderSet.html#removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module-headerset-HeaderSet.html#removeHeader">removeHeader</a></li><li data-type='method'><a href="module-headerset-HeaderSet.html#toString">toString</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-functions.html">functions</a><ul class='methods'><li data-type='method'><a href="module-functions.html#.absolutize">absolutize</a></li><li data-type='method'><a href="module-functions.html#.absolutizeSrcs">absolutizeSrcs</a></li><li data-type='method'><a href="module-functions.html#.activeLayers">activeLayers</a></li><li data-type='method'><a href="module-functions.html#.addAssets">addAssets</a></li><li data-type='method'><a href="module-functions.html#.addCanonicalTag">addCanonicalTag</a></li><li data-type='method'><a href="module-functions.html#.assert">assert</a></li><li data-type='method'><a href="module-functions.html#.asset">asset</a></li><li data-type='method'><a href="module-functions.html#.cleanMobileMetaTags">cleanMobileMetaTags</a></li><li data-type='method'><a href="module-functions.html#.getPageType">getPageType</a></li><li data-type='method'><a href="module-functions.html#.handleRobots">handleRobots</a></li><li data-type='method'><a href="module-functions.html#.insertDnsPrefetch">insertDnsPrefetch</a></li><li data-type='method'><a href="module-functions.html#.insertSubresource">insertSubresource</a></li><li data-type='method'><a href="module-functions.html#.isRobots">isRobots</a></li><li data-type='method'><a href="module-functions.html#.layer">layer</a></li><li data-type='method'><a href="module-functions.html#.layerNot">layerNot</a></li><li data-type='method'><a href="module-functions.html#.moveStylesAboveScripts">moveStylesAboveScripts</a></li><li data-type='method'><a href="module-functions.html#.moveStylesToHead">moveStylesToHead</a></li><li data-type='method'><a href="module-functions.html#.onDevelopment">onDevelopment</a></li><li data-type='method'><a href="module-functions.html#.perfectProxy">perfectProxy</a></li><li data-type='method'><a href="module-functions.html#.queryLayerText">queryLayerText</a></li><li data-type='method'><a href="module-functions.html#.relocateScripts">relocateScripts</a></li><li data-type='method'><a href="module-functions.html#.removeAllStyles">removeAllStyles</a></li><li data-type='method'><a href="module-functions.html#.removeDesktopJs">removeDesktopJs</a></li><li data-type='method'><a href="module-functions.html#.removeDesktopMobileIcon">removeDesktopMobileIcon</a></li><li data-type='method'><a href="module-functions.html#.removeHtmlComments">removeHtmlComments</a></li><li data-type='method'><a href="module-functions.html#.rewriteAspNetScripts">rewriteAspNetScripts</a></li><li data-type='method'><a href="module-functions.html#.rewriteJsSrcs">rewriteJsSrcs</a></li><li data-type='method'><a href="module-functions.html#.rewriteLink">rewriteLink</a></li><li data-type='method'><a href="module-functions.html#.rewriteLinks">rewriteLinks</a></li><li data-type='method'><a href="module-functions.html#.rewriteToProxy">rewriteToProxy</a></li><li data-type='method'><a href="module-functions.html#.sass">sass</a></li><li data-type='method'><a href="module-functions.html#.setPageType">setPageType</a></li><li data-type='method'><a href="module-functions.html#~gatherHosts">gatherHosts</a></li></ul></li><li><a href="module-headerset.html">headerset</a></li><li><a href="module-stdlib.html">stdlib</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-headerset-HeaderSet_fns.html">fns</a><ul class='methods'><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.addHeader">addHeader</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.header">header</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.method">method</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.method">method</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.path">path</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.path">path</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.removeHeader">removeHeader</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.statusCode">statusCode</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.statusCode">statusCode</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.statusText">statusText</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.statusText">statusText</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.versionMinor">versionMinor</a></li><li data-type='method'><a href="module-headerset-HeaderSet_fns.html#.versionMinor">versionMinor</a></li></ul></li><li><a href="module-stdlib-stdlib.html">stdlib</a><ul class='methods'><li data-type='method'><a href="module-stdlib-stdlib.html#.addCookie">addCookie</a></li><li data-type='method'><a href="module-stdlib-stdlib.html#.export">export</a></li><li data-type='method'><a href="module-stdlib-stdlib.html#.init$">init$</a></li><li data-type='method'><a href="module-stdlib-stdlib.html#.scoped$">scoped$</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#breakpoint">breakpoint</a></li><li><a href="global.html#env">env</a></li><li><a href="global.html#layers">layers</a></li><li><a href="global.html#rules">rules</a></li><li><a href="global.html#tag">tag</a></li><li><a href="global.html#txt">txt</a></li></ul>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>moov_stdlib</h1><p>A small library of functions for efficiently manipulating HTML.</p>
<h2>Intro</h2><p>This module contains the critical functions used by Moovweb projects to transform the web. 
It provides the fns object used to organize the DOM within the Moovweb Node Environment.
A version of moov_stdlib is required for Moovweb javascript projects to run, and the version to be used by a given project can be specified in that project's package.json file.</p>
<h2>Quick Start</h2><p>After entering your project's directory, you can install your local dependencies with:</p>
<p><code>npm install</code></p>
<p>This will install all required dependencies into the local node_modules folder. </p>
<p>This is necessary before bundling a project for deployment.</p>
<p>This is intended to be run within a moovweb project's root directory.</p>
<h2>Example usage</h2><p>It is unlikely that you will need to instantiate the moov_stdlib module directly; this is done at the sandbox level inside the node server that will be running your project code. For running the module locally or in a terminal, a context object can be passed to the constructor to simulate the environment and headers of an incoming http request. See test/fixed_job.json for an example context file.</p>
<p>Example:</p>
<p><code>const moov_stdlib = require(&quot;moov_stdlib&quot;)(ctx);</code></p>
<p>This is currently done at the sandbox level and exposed as the &quot;fns&quot; object when running code on the Moovweb Cloud.</p>
<p>The following examples will refer to fns, which is effectively an interface to the module.exports of the moov_stdlib module.</p>
<h3>init$</h3><p>The init$ function loads a utf8 encodied string of an HTML request into the cheerio.js parsing library, and provides global variables to efficiently query the DOM thereafter.</p>
<pre class="prettyprint source"><code>let lib = fns.init$(document, [{options: etc...}])</code></pre><p>This sets up the globals explicitly used in previous javascript projects:</p>
<pre class="prettyprint source"><code>$
scoped$
root
html
head
body</code></pre><p>$ and scoped$ are functions that can be called to select code in the dom, and root, html, head, and body point to their respective cheerio selections of the DOM attributes</p>
<h3>$</h3><p>init$ exposes the global $ function, which can be used to select nodes from the root scope, no matter where you are in your code</p>
<p>Ex: To tag all script nodes in the DOM</p>
<pre class="prettyprint source"><code>$(&quot;script&quot;).attr(&quot;data-mw-keep&quot;, true);</code></pre><h3>scoped$</h3><p>init$ also exposes the global scoped$() can be used to narrow down parts of the DOM you wish to use</p>
<p>Ex: To add the data-mw-keep attribute to scripts inside the body, do:</p>
<pre class="prettyprint source"><code>scoped$(body, function(){
    scoped$(&quot;script&quot;, function(){
        $this.attr(&quot;data-mw-keep&quot;, true);
    });
});</code></pre><p>When $ is called inside a scope, it supercedes the scope and can be used to access DOM elements outisde the current scope.</p>
<p>Ex: You can access and modify script tags outside the scope of the body with the single dollar sign. Using scoped$ will maintain the current scope.</p>
<pre class="prettyprint source"><code>scoped$(body, function(){
    scoped$(&quot;script&quot;, function(){
        $this.attr(&quot;data-body&quot;, true);
    });
    $(&quot;script&quot;, function(){
        $this.attr(&quot;data-global&quot;, true);
    });
});</code></pre><h3>export</h3><p>Set custom environment variables</p>
<pre class="prettyprint source"><code>fns.export(&quot;x-custom-key&quot;, &quot;custom-var&quot;)</code></pre><h3>addCookie</h3><p>Set a cookie while processing the current request.</p>
<pre class="prettyprint source"><code>fns.addCookie(name, value, domain, path, expires, secure, httpOnly)</code></pre><h3>headerset</h3><p>An interface for adding and removing headers from the current request.</p>
<pre class="prettyprint source"><code>fns.headerset.header(key, val)
fns.headerset.addHeader(key, val)
fns.headerset.removeHeader(key)</code></pre><h3>fns</h3><p>Helper functions for setting up the dom can all be called from the stdlib object
moov_stdlib.</p>
<p>Ex:</p>
<pre class="prettyprint source"><code>fns.absolutizeSrcs()</code></pre><p>The following methods defined in /lib/functions are all available:</p>
<pre class="prettyprint source"><code>absolutize
addCanonicalTag
rewriteToProxy
rewriteLink
rewriteLinks
absolutizeSrcs
rewriteAspNetScripts
removeAllStyles
cleanMobileMetaTags
removeDesktopMobileIcon
removeHtmlComments
addAssets
removeDesktopJs
isRobots
handleRobots
relocateScripts</code></pre><h3>activeLayers</h3><p>fns.activeLayers outputs information about the layers being used to transform the project</p>
<h3>assert</h3><p>fns.assert()  can be used to evaluate expressions and throw exceptions when developing locally</p>
<p>Ex:</p>
<pre class="prettyprint source"><code>fns.assert(function(){return $(&quot;#important-div&quot;).length > 0});</code></pre><h2>Tests</h2><p>Run the test suite with</p>
<p><code>npm test</code></p>
<h2>Run Locally via Node CLI</h2><p>Optionally, to run this module from inside the node CLI on its own, you can require the main.js file explicitly via:</p>
<p><code>node --harmony</code></p>
<p><code>&gt; var moov_stdlib = require(&quot;./main.js&quot;);</code></p></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated at Wed Oct 07 2015 14:26:33 GMT-0700 (PDT)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>