<body>

<div data-section="accordion" id="content-nav">
  <section>
      <ul class="doc-sidebar" data-section-content data-section="accordion" id="content-sidebar"><section><a href="#" data-section-title>Classes</a><ul data-section-content data-section="accordion" ><section><a href="module_headerset_HeaderSet" class="" data-section-title>HeaderSet</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_headerset_HeaderSet#addHeader">addHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet#header">header</a></li><li data-type='method'><a href="module_headerset_HeaderSet#removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module_headerset_HeaderSet#removeHeader">removeHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet#toString">toString</a></li></ul></section></ul></section><section><a href="#" data-section-title>Modules</a><ul data-section-content data-section="accordion" ><section><a href="module_functions" class="" data-section-title>functions</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_functions#.absolutize">absolutize</a></li><li data-type='method'><a href="module_functions#.absolutizeSrcs">absolutizeSrcs</a></li><li data-type='method'><a href="module_functions#.activeLayers">activeLayers</a></li><li data-type='method'><a href="module_functions#.addAssets">addAssets</a></li><li data-type='method'><a href="module_functions#.addCanonicalTag">addCanonicalTag</a></li><li data-type='method'><a href="module_functions#.assert">assert</a></li><li data-type='method'><a href="module_functions#.asset">asset</a></li><li data-type='method'><a href="module_functions#.cleanMobileMetaTags">cleanMobileMetaTags</a></li><li data-type='method'><a href="module_functions#.getPageType">getPageType</a></li><li data-type='method'><a href="module_functions#.handleRobots">handleRobots</a></li><li data-type='method'><a href="module_functions#.highlight_development">highlight_development</a></li><li data-type='method'><a href="module_functions#.highlight_preview">highlight_preview</a></li><li data-type='method'><a href="module_functions#.insertDnsPrefetch">insertDnsPrefetch</a></li><li data-type='method'><a href="module_functions#.insertSubresource">insertSubresource</a></li><li data-type='method'><a href="module_functions#.isRobots">isRobots</a></li><li data-type='method'><a href="module_functions#.layer">layer</a></li><li data-type='method'><a href="module_functions#.layerNot">layerNot</a></li><li data-type='method'><a href="module_functions#.moveStylesAboveScripts">moveStylesAboveScripts</a></li><li data-type='method'><a href="module_functions#.moveStylesToHead">moveStylesToHead</a></li><li data-type='method'><a href="module_functions#.onDevelopment">onDevelopment</a></li><li data-type='method'><a href="module_functions#.perfectProxy">perfectProxy</a></li><li data-type='method'><a href="module_functions#.queryLayerText">queryLayerText</a></li><li data-type='method'><a href="module_functions#.relocateScripts">relocateScripts</a></li><li data-type='method'><a href="module_functions#.removeAllStyles">removeAllStyles</a></li><li data-type='method'><a href="module_functions#.removeDesktopJs">removeDesktopJs</a></li><li data-type='method'><a href="module_functions#.removeDesktopMobileIcon">removeDesktopMobileIcon</a></li><li data-type='method'><a href="module_functions#.removeHtmlComments">removeHtmlComments</a></li><li data-type='method'><a href="module_functions#.rewriteAspNetScripts">rewriteAspNetScripts</a></li><li data-type='method'><a href="module_functions#.rewriteJsSrcs">rewriteJsSrcs</a></li><li data-type='method'><a href="module_functions#.rewriteLink">rewriteLink</a></li><li data-type='method'><a href="module_functions#.rewriteLinks">rewriteLinks</a></li><li data-type='method'><a href="module_functions#.rewriteToProxy">rewriteToProxy</a></li><li data-type='method'><a href="module_functions#.sass">sass</a></li><li data-type='method'><a href="module_functions#.setPageType">setPageType</a></li><li data-type='method'><a href="module_functions#~gatherHosts">gatherHosts</a></li></ul></section><li><a href="module_headerset">headerset</a></li><li><a href="module_stdlib">stdlib</a></li></ul></section><section><a href="#" data-section-title>Namespaces</a><ul data-section-content data-section="accordion" ><section><a href="module_headerset_HeaderSet_fns" class="" data-section-title>fns</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_headerset_HeaderSet_fns#.addHeader">addHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.header">header</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.method">method</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.method">method</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.path">path</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.path">path</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.removeHeader">removeHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusCode">statusCode</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusCode">statusCode</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusText">statusText</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusText">statusText</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.versionMinor">versionMinor</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.versionMinor">versionMinor</a></li></ul></section><section><a href="module_stdlib_stdlib" class="" data-section-title>stdlib</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_stdlib_stdlib#.addCookie">addCookie</a></li><li data-type='method'><a href="module_stdlib_stdlib#.export">export</a></li><li data-type='method'><a href="module_stdlib_stdlib#.init$">init$</a></li><li data-type='method'><a href="module_stdlib_stdlib#.scoped$">scoped$</a></li></ul></section></ul></section><section><a href="#" data-section-title>Global</a><ul data-section-content data-section="accordion"><li><a href="global#breakpoint">breakpoint</a></li><li><a href="global#env">env</a></li><li><a href="global#layers">layers</a></li><li><a href="global#project">project</a></li><li><a href="global#rules">rules</a></li><li><a href="global#tag">tag</a></li><li><a href="global#txt">txt</a></li></ul></section></ul>
  </section>
</div>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>moov_stdlib</h1><p>A small library of functions for efficiently manipulating HTML.</p>
<h2>Intro</h2><p>This module contains the critical functions used by Moovweb projects to transform the web. 
It provides the fns object used to organize the DOM within the Moovweb Node Environment.
A version of moov_stdlib is required for Moovweb javascript projects to run, and the version to be used by a given project can be specified in that project's package.json file.</p>
<h2>Quick Start</h2><p>After entering your project's directory, you can install your local dependencies with:</p>
<p><code>npm install</code></p>
<p>This will install all required dependencies into the local node_modules folder. </p>
<p>This is necessary before bundling a project for deployment.</p>
<p>This is intended to be run within a moovweb project's root directory.</p>
<h2>Example usage</h2><p>It is unlikely that you will need to instantiate the moov_stdlib module directly; this is done at the sandbox level inside the node server that will be running your project code. For running the module locally or in a terminal, a context object can be passed to the constructor to simulate the environment and headers of an incoming http request. See test/fixed_job.json for an example context file.</p>
<p>Example:</p>
<p><code>const moov_stdlib = require(&quot;moov_stdlib&quot;)(ctx);</code></p>
<p>This is currently done at the sandbox level and exposed as the &quot;fns&quot; object when running code on the Moovweb Cloud.</p>
<p>The following examples will refer to fns, which is effectively an interface to the module.exports of the moov_stdlib module.</p>
<h3>init$</h3><p>The init$ function loads a utf8 encodied string of an HTML request into the cheerio.js parsing library, and provides global variables to efficiently query the DOM thereafter.</p>
<pre class="prettyprint source"><code>let lib = fns.init$(document, [{options: etc...}])</code></pre><p>This sets up the globals explicitly used in previous javascript projects:</p>
<pre class="prettyprint source"><code>$
scoped$
root
html
head
body</code></pre><p>$ and scoped$ are functions that can be called to select code in the dom, and root, html, head, and body point to their respective cheerio selections of the DOM attributes</p>
<h3>$</h3><p>init$ exposes the global $ function, which can be used to select nodes from the root scope, no matter where you are in your code</p>
<p>Ex: To tag all script nodes in the DOM</p>
<pre class="prettyprint source"><code>$(&quot;script&quot;).attr(&quot;data-mw-keep&quot;, true);</code></pre><h3>scoped$</h3><p>init$ also exposes the global scoped$() can be used to narrow down parts of the DOM you wish to use</p>
<p>Ex: To add the data-mw-keep attribute to scripts inside the body, do:</p>
<pre class="prettyprint source"><code>scoped$(body, function(){
    scoped$(&quot;script&quot;, function(){
        $this.attr(&quot;data-mw-keep&quot;, true);
    });
});</code></pre><p>When $ is called inside a scope, it supercedes the scope and can be used to access DOM elements outisde the current scope.</p>
<p>Ex: You can access and modify script tags outside the scope of the body with the single dollar sign. Using scoped$ will maintain the current scope.</p>
<pre class="prettyprint source"><code>scoped$(body, function(){
    scoped$(&quot;script&quot;, function(){
        $this.attr(&quot;data-body&quot;, true);
    });
    $(&quot;script&quot;, function(){
        $this.attr(&quot;data-global&quot;, true);
    });
});</code></pre><h3>export</h3><p>Set custom environment variables</p>
<pre class="prettyprint source"><code>fns.export(&quot;x-custom-key&quot;, &quot;custom-var&quot;)</code></pre><h3>addCookie</h3><p>Set a cookie while processing the current request.</p>
<pre class="prettyprint source"><code>fns.addCookie(name, value, domain, path, expires, secure, httpOnly)</code></pre><h3>headerset</h3><p>An interface for adding and removing headers from the current request.</p>
<pre class="prettyprint source"><code>fns.headerset.header(key, val)
fns.headerset.addHeader(key, val)
fns.headerset.removeHeader(key)</code></pre><h3>fns</h3><p>Helper functions for setting up the dom can all be called from the stdlib object
moov_stdlib.</p>
<p>Ex:</p>
<pre class="prettyprint source"><code>fns.absolutizeSrcs()</code></pre><p>The following methods defined in /lib/functions are all available:</p>
<pre class="prettyprint source"><code>absolutize
addCanonicalTag
rewriteToProxy
rewriteLink
rewriteLinks
absolutizeSrcs
rewriteAspNetScripts
removeAllStyles
cleanMobileMetaTags
removeDesktopMobileIcon
removeHtmlComments
addAssets
removeDesktopJs
isRobots
handleRobots
relocateScripts</code></pre><h3>activeLayers</h3><p>fns.activeLayers outputs information about the layers being used to transform the project</p>
<h3>assert</h3><p>fns.assert()  can be used to evaluate expressions and throw exceptions when developing locally</p>
<p>Ex:</p>
<pre class="prettyprint source"><code>fns.assert(function(){return $(&quot;#important-div&quot;).length > 0});</code></pre><h3>highlight_preview([position])</h3><p>Insert banner on the page if viewing a preview mode. This allows a clear differentiation between preview modes and live modes. Position could be &quot;top&quot; or &quot;bottom&quot;. Position is default as &quot;bottom&quot; if it is not assigned.</p>
<p>Ex:</p>
<pre class="prettyprint source"><code>fns.highlight_preview('top');</code></pre><h3>highlight_development([position])</h3><p>Insert banner on the page if developing locally. This allows a clear differentiation between the proxied single domain site and the original site. Position could be &quot;top&quot; or &quot;bottom&quot;. Position is default as &quot;bottom&quot; if it is not assigned.</p>
<p>Ex:</p>
<pre class="prettyprint source"><code>fns.highlight_development('bottom');</code></pre><h2>Tests</h2><p>Run the test suite with</p>
<p><code>npm test</code></p>
<h2>Run Locally via Node CLI</h2><p>Optionally, to run this module from inside the node CLI on its own, you can require the main.js file explicitly via:</p>
<p><code>node --harmony</code></p>
<p><code>&gt; var moov_stdlib = require(&quot;./main.js&quot;);</code></p></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated at Fri Dec 18 2015 19:12:04 GMT+0000 (UTC)
</footer>

<script>prettyPrint();</script>
</body>