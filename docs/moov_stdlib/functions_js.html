<body>

<div data-section="accordion" id="content-nav">
  <section>
      <ul class="doc-sidebar" data-section-content id="content-sidebar"><div data-section="accordion"><section class="active"><a href="#" class="module-one" data-section-title>Namespaces</a><ul data-section-content><div data-section='accordion'><section class='active'><a href="fns" class="" data-section-title>fns</a><ul class='methods' data-section-content><li data-type='method'><a href="fns#.absolutize">.absolutize()</a></li><li data-type='method'><a href="fns#.absolutizeSrcs">.absolutizeSrcs()</a></li><li data-type='method'><a href="fns#.activeLayers">.activeLayers()</a></li><li data-type='method'><a href="fns#.addAssets">.addAssets()</a></li><li data-type='method'><a href="fns#.addCanonicalTag">.addCanonicalTag()</a></li><li data-type='method'><a href="fns#.addCookie">.addCookie()</a></li><li data-type='method'><a href="fns#.assert">.assert()</a></li><li data-type='method'><a href="fns#.asset">.asset()</a></li><li data-type='method'><a href="fns#.cleanMobileMetaTags">.cleanMobileMetaTags()</a></li><li data-type='method'><a href="fns#.export">.export()</a></li><li data-type='method'><a href="fns#.getPageType">.getPageType()</a></li><li data-type='method'><a href="fns#.handleRobots">.handleRobots()</a></li><li data-type='method'><a href="fns#.highlightDevelopment">.highlightDevelopment()</a></li><li data-type='method'><a href="fns#.highlightPreview">.highlightPreview()</a></li><li data-type='method'><a href="fns#.init$">.init$()</a></li><li data-type='method'><a href="fns#.insertDnsPrefetch">.insertDnsPrefetch()</a></li><li data-type='method'><a href="fns#.insertSubresource">.insertSubresource()</a></li><li data-type='method'><a href="fns#.isRobots">.isRobots()</a></li><li data-type='method'><a href="fns#.layer">.layer()</a></li><li data-type='method'><a href="fns#.layerNot">.layerNot()</a></li><li data-type='method'><a href="fns#.moveStylesAboveScripts">.moveStylesAboveScripts()</a></li><li data-type='method'><a href="fns#.moveStylesToHead">.moveStylesToHead()</a></li><li data-type='method'><a href="fns#.onDevelopment">.onDevelopment()</a></li><li data-type='method'><a href="fns#.perfectProxy">.perfectProxy()</a></li><li data-type='method'><a href="fns#.queryLayerText">.queryLayerText()</a></li><li data-type='method'><a href="fns#.relocateScripts">.relocateScripts()</a></li><li data-type='method'><a href="fns#.removeAllStyles">.removeAllStyles()</a></li><li data-type='method'><a href="fns#.removeDesktopJs">.removeDesktopJs()</a></li><li data-type='method'><a href="fns#.removeDesktopMobileIcon">.removeDesktopMobileIcon()</a></li><li data-type='method'><a href="fns#.removeHtmlComments">.removeHtmlComments()</a></li><li data-type='method'><a href="fns#.rewriteAspNetScripts">.rewriteAspNetScripts()</a></li><li data-type='method'><a href="fns#.rewriteJsSrcs">.rewriteJsSrcs()</a></li><li data-type='method'><a href="fns#.rewriteLink">.rewriteLink()</a></li><li data-type='method'><a href="fns#.rewriteLinks">.rewriteLinks()</a></li><li data-type='method'><a href="fns#.rewriteToProxy">.rewriteToProxy()</a></li><li data-type='method'><a href="fns#.sass">.sass()</a></li><li data-type='method'><a href="fns#.scoped$">.scoped$()</a></li><li data-type='method'><a href="fns#.setPageType">.setPageType()</a></li><li data-type='method'><a href="fns#.slashPath">.slashPath()</a></li></ul></section></div><div data-section='accordion'><section class='active'><a href="headers" class="" data-section-title>headers</a><ul class='methods' data-section-content><li data-type='method'><a href="headers#.method">method</a></li><li data-type='method'><a href="headers#.path">path</a></li><li data-type='method'><a href="headers#.statusCode">statusCode</a></li><li data-type='method'><a href="headers#.statusText">statusText</a></li><li data-type='method'><a href="headers#.versionMinor">versionMinor</a></li><li data-type='method'><a href="headers#.addHeader">.addHeader()</a></li><li data-type='method'><a href="headers#.header">.header()</a></li><li data-type='method'><a href="headers#.removeAllHeaders">.removeAllHeaders()</a></li><li data-type='method'><a href="headers#.removeHeader">.removeHeader()</a></li></ul></section></div></ul></section></div><div data-section="accordion"><section class="active"><a href="#" class="module-one" data-section-title>Global</a><ul data-section-content><li><a href="global#breakpoint">breakpoint</a></li><li><a href="global#tag">tag</a></li><li><a href="global#txt">txt</a></li></ul></section></div></ul>
  </section>
</div>

<div id="main">
    
    <h1 class="page-title">functions.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Use the `fns` namespace for standard Moovweb functionality.
 * @namespace fns
 */

/* globals $, $body, env, $head, $html, layers, $root, tag, txt, rules, project */

'use strict';
const url = require('url');
const path = require('path');
const banner = require('./banner');
// The following can be used to manipulate a serialized dom object
// body, head, html are assigned when invoking stdlib.init$(selectorEngine, requestBody)

/**
 * @function tag
 * @summary functions
 * @description Creates a new element. Note that this is &lt;i>not&lt;/i> a Cheerio
 * object: you should wrap it in `$()` if Cheerio methods need to be invoked on
 * it.
 * @param {String} name A string for the name of the element.
 * @param {Object} [attribs] An object containing the attribute-value pairs of
 * the new element.
 * @param {String} [content] A string for the text node for the new element.
 * @return {Object} An object associated with the newly-created DOM element.
 * defined by the arguments passed in (denoted by a `type` value of "tag").
 * @example
 * let grape = tag("li", {class: "grape"}, "Grape");
 * grape.insertAfter(".apple");
 * // => Throws: TypeError (grape is not a Cheerio object, and the object
 * //    associated with the grape DOM element does not have an insertAfter
 * //    method defined)
 * $body.find("ul").append(grape);
 * // => Note: This is OK - you can append a non-Cheerio object here
 * // => HTML output:
 * //    &lt;ul id="fruits">
 * //      &lt;li class="apple" data-which="fuji">Apple&lt;/li>
 * //      &lt;li class="grape">Grape&lt;/li>
 * //      &lt;li class="pear">Pear&lt;/li>
 * //      &lt;li class="orange">Orange&lt;/li>
 * //    &lt;/ul>
 * @example
 * let $grape = $(tag("div", {class: "grape"}, "Grape"));
 * $grape.insertAfter(".apple");
 * // => Returns: original Cheerio object associated with the newly-created
 * //    `.grape` element
 * // => HTML output:
 * //    &lt;ul id="fruits">
 * //      &lt;li class="apple" data-which="fuji">Apple&lt;/li>
 * //      &lt;li class="grape">Grape&lt;/li>
 * //      &lt;li class="pear">Pear&lt;/li>
 * //      &lt;li class="orange">Orange&lt;/li>
 * //    &lt;/ul>
 */
global.tag = function(name, attribs, content) {
    let type = name === 'script' || name === 'style' ? name : 'tag';
    return {
        // for some reason &lt;script> and &lt;style> aren't exactly elements in htmlparser2
        // __proto__: type == 'tag' ? ElementPrototype : NodePrototype, // uncomment if withDomLvl1 is true
        type: type,
        name: name,
        attribs: attribs || {},
        children: content ? [txt(content)] : [],
        next: null,
        prev: null,
        parent: null
    };
};

/**
 * @function txt
 * @summary functions
 * @description Creates a new text node.
 * @param {string} content A string for the content that the text node will
 * contain.
 * @return {Object} An object associated with the newly-created text node
 * defined by the `content` argument passed in (denoted by a `type` value of
 * "text").
 * @example
 * $body.find(".apple").append(txt(", more text"));
 * // => HTML output:
 * //    &lt;ul id="fruits">
 * //      &lt;li class="apple" data-which="fuji">Apple, more text&lt;/li>
 * //      &lt;li class="pear">Pear&lt;/li>
 * //      &lt;li class="orange">Orange&lt;/li>
 * //    &lt;/ul>
 *
 */
global.txt = function(content) {
    return {
        // __proto__: NodePrototype, // uncomment if withDomLvl1 is true
        data: content,
        type: 'text',
        next: null,
        prev: null,
        parent: null
    };
};

/**
 * @function breakpoint
 * @summary functions
 * @description Calls the debugger and logs a message to the console, provided
 * that the debug mode has been enabled (the moov_debug parameter must exist in
 * the URL and the Dashboard Inspector must be open).
 * @param {String} breakpointId A string for a breakpoint terminal message.
 * @return {undefined} `undefined`
 * @example
 * if (env.path.indexOf("moov_debug=true") >= 0) {
 *   breakpoint("Parameter 'moov_debug=true' detected in the URL.");
 * }
 * // => Result: Breaks in the Dashboard Inspector and logs the appropriate
 * //    message.
 */
global.breakpoint = function(breakpointId) {
    if (global.debugEnabled) {
        console.log('Moov SDK breakpoint:', (breakpointId || ''));
        /*jshint -W087 */ // Allow debugger; statement
        debugger;
    }
};

/**
 * @method asset
 * @summary functions
 * @memberof fns
 * @description Retrieves the URL for the specified JavaScript or image asset
 * path, which changes depending upon the project environment.
 * @param {String} pathToFile A string for the relative path to the asset file.
 * Must be relative to the &lt;em>assets&lt;/em> directory in your project structure.
 * @return {String} A string containing the URL for the JavaScript or image
 * asset.
 * @example
 * $body.append(tag("script", {type: "text/javascript", src: fns.asset("javascript/custom_script.js")}));
 * // => HTML input:
 * //    &lt;body>&lt;/body>
 * // => HTML output (local):
 * //    &lt;body>
 * //      &lt;script type="text/javascript" src="//mlocal.mysite.com/_moovweb_local_assets_/javascript/custom_script.js">&lt;/script>
 * //    &lt;/body>
 * // => HTML output (production):
 * //    &lt;body>
 * //      &lt;script type="text/javascript" src="//assets.moovweb.net/project-uid/mode-uid/build-version/javascript/custom_script.js">&lt;/script>
 * //    &lt;/body>
 */
exports.asset = function(pathToFile) {
    return url.resolve(url.format(env.asset_host), pathToFile);
};

/**
 * @method addCanonicalTag
 * @summary functions
 * @memberof fns
 * @description Injects a canonical tag into the head, as long as one doesn't
 * already exist. Additionally, remove any alternate tags.
 * @return {undefined} `undefined`
 * @example
 * fns.addCanonicalTag();
 * // => HTML input:
 * //    &lt;head>&lt;/head>
 * // => HTML output:
 * //    &lt;head>
 * //      &lt;link rel="canonical" href="http://www.mysite.com/">
 * //    &lt;/head>
 */
exports.addCanonicalTag = function() {
    // Inject a canonical link as long as there isn't already one.
    if (!$head.find('link[rel="canonical"]')[0]) {
        $head.append(
            tag('link', {rel: 'canonical', href: 'http://' + env.source_host + env.path})
        );
    }
    // Remove any alternate tags
    $head.find('link[rel="alternate"]').remove();
};

/**
 * @method rewriteToProxy
 * @summary functions
 * @memberof fns
 * @description Rewrites a given link to the Moovweb proxy, given additional
 * security and domain settings.
 * @param {String} hostHH A string for the host link to be rewritten.
 * @param {Boolean} secure A boolean for whether you're on the secure protocol,
 * allowing for the rewriting process to speed up if in the proper environment
 * @param {String} catchAll A string for a catch-all domain, such as
 * .moovapp.com (for when a CNAME isn't set up and your project is pushed to
 * the Moovweb staging cluster).
 * @return {String} A string containing the link rewritten to the Moovweb proxy.
 * @example
 * fns.rewriteToProxy("www.mysite.com", false, env.__catch_all__);
 * // => Returns (local): "mlocal.mysite.com"
 * // => Returns (production with CNAME): "m.mysite.com"
 * // => Returns (moovapp staging): "m.mysite.com.moovapp.com"
 * @example
 * fns.rewriteToProxy("//www.mysite.com", false, env.__catch_all__);
 * // => Returns (local): "//mlocal.mysite.com"
 * // => Returns (production with CNAME): "//m.mysite.com"
 * // => Returns (moovapp staging): "//m.mysite.com.moovapp.com"
 */
exports.rewriteToProxy = function(hostHH, secure, catchAll) {
    var parsedHost, sanitizedHost, prefix, missing ="", ctxRules, result;

    // fixup links that have been passed in with no protocol, or begin with forward slashes
    // parsing a bad url before doing this will lead to a Url object with unset keys
    prefix = hostHH.match(/^(?:https?:)?\/\//);
    if (!prefix) {
        missing = secure ? 'https://' : 'http://';
    }
    else if (prefix[0] === '//') {
        missing = secure ? 'https:' : 'http:';
    }
    sanitizedHost = missing + hostHH;

    // parse the sanitized host into a url object
    parsedHost = url.parse(sanitizedHost);
    if (parsedHost.port !== null &amp;&amp; !(parsedHost.port === '443' || parsedHost.port === '80')) {
        // skip rewriting links using nonstandard ports
        return hostHH;
    }
    // Prevent adding the trailing slash when formatting
    parsedHost.pathname = "";

    // load the rules or interpolate them if they are missing from the context
    ctxRules = rules || [
        {
            Proxy: 'http://' + env.host,
            Upstream: 'http://' + env.source_host
        },
        {
            Proxy: 'https://' + env.host,
            Upstream: 'https://' + env.source_host
        },
        {
            Proxy: 'http://' + env.host,
            Upstream: 'http://' + env.source_host.replace(/^www\./, '')
        },
        {
            Proxy: 'https://' + env.host,
            Upstream: 'https://' + env.source_host.replace(/^www\./, '')
        }
    ];

    if (ctxRules[0]) {
        for (var i = 0; i &lt; ctxRules.length; i++) {
            var rr = ctxRules[i];
            var match = sanitizedHost.match(rr.Upstream);
            if (rr.Direction !== 1 &amp;&amp; match!==null &amp;&amp; match.index===0) {
                // We found a match
                var proxy = url.parse(rr.Proxy);
                // Prevent adding the trailing slash when formatting
                proxy.pathname = "";

                if (env.__catch_all_enabled__ === 'true') {
                    if (!proxy.host.match(catchAll)) {
                        // The host should have the catchall appended, but doesn't yet
                        proxy.hostname = proxy.hostname + catchAll;
                        // unsetting host will reformat the url for us
                        proxy.host = undefined;
                    }
                }

                result = url.format(proxy);
                if (result.substring(0, missing.length) === missing) {
                    result = result.substring(missing.length);
                }

                return result;
            }
        }
    }
    return hostHH;
};

/**
 * @method rewriteLink
 * @summary functions
 * @memberof fns
 * @description Rewrites a given absolute link to the Moovweb proxy (using
 * rewriteToProxy(), with default settings applied).
 * @param {String} hostHH A string for the host link to be rewritten.
 * @return {String} A string containing the link rewritten to the Moovweb proxy.
 * @example
 * fns.rewriteLink("www.mysite.com");
 * // => Returns (local): "mlocal.mysite.com"
 * // => Returns (production with CNAME): "m.mysite.com"
 * // => Returns (moovapp staging): "m.mysite.com.moovapp.com"
 * @example
 * fns.rewriteLink("//www.mysite.com");
 * // => Returns (local): "//mlocal.mysite.com"
 * // => Returns (production with CNAME): "//m.mysite.com"
 * // => Returns (moovapp staging): "//m.mysite.com.moovapp.com"
 * @example
 * fns.rewriteLink("https://mysite.com");
 * // => Returns (local, if naked subdomain in moov_config.json):
 * //    "https://mlocal.mysite.com"
 * // => Returns (production CNAME, if naked subdomain in moov_config.json):
 * //    "https://m.mysite.com"
 * // => Returns (moovapp staging, if naked subdomain in moov_config.json):
 * //    "https://m.mysite.com.moovapp.com"
 * // => Returns (if naked subdomain _not_ in moov_config.json):
 * //    "https://mysite.com"
 * @example
 * fns.rewriteLink("http://www.google.com/");
 * //=> Returns (if origin is not Google): "http://www.google.com/"
 * @example
 * fns.rewriteLink("/test.js");
 * // => Returns (stays the same): "/test.js"
 */
exports.rewriteLink = function(link) {
    link = link.trim();
    if (/^mailto:/.test(link)) {
        return link;
    }
    return link.replace(/((?:(?:(?:http(?:s?)):)?(?:\/\/)?(?:(?:[a-zA-Z0-9][a-zA-Z0-9\-]*)(?:\.[\.a-zA-Z0-9\-]*)|localhost))(?:\:[0-9]+)?)/gi, function(hostHH) {
        var rewritten = exports.rewriteToProxy(hostHH, env.secure === 'true', env.__catch_all__);
        return rewritten;
    });
};

/**
 * @method rewriteLinks
 * @summary functions
 * @memberof fns
 * @description Rewrites all links (`a` and `base` elements) to the correct
 * domain.
 * @return {undefined} `undefined`
 * @example
 * fns.rewriteLinks();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;base href="http://www.mysite.com/">
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;a href="www.mysite.com/">Test&lt;/a>
 * //      &lt;a href="//www.mysite.com/">Test&lt;/a>
 * //      &lt;a href="//www.google.com/">Test&lt;/a>
 * //    &lt;/body>
 * // => HTML output:
 * //    &lt;head>
 * //      &lt;base href="http://m.mysite.com/" />
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;a href="m.mysite.com/">Test&lt;/a>
 * //      &lt;a href="//m.mysite.com/">Test&lt;/a>
 * //      &lt;a href="//www.google.com/">Test&lt;/a>
 * //    &lt;/body>
 */
exports.rewriteLinks = function() {
    $html.find('a, head base[href]').attr('href', function(_, attr) {
        return attr ? exports.rewriteLink(attr) : null;
    });
    $html.find('form').attr('action', function(_, attr) {
        return attr ? exports.rewriteLink(attr) : null;
    });
};

/**
 * @method slashPath
 * @summary functions
 * @memberof fns
 * @description Gives the string for the given path's parent directory.
 * @return {String} A string for the slash path.
 * @example
 * fns.slashPath();
 * // => Returns (when on http://m.mysite.com/):
 * //    "/"
 * // => Returns (when on http://m.mysite.com/product):
 * //    "/"
 * // => Returns (when on http://m.mysite.com/product/):
 * //    "/product"
 * // => Returns (when on http://m.mysite.com/product/mittens):
 * //    "/product"
 * // => Returns (when on http://m.mysite.com/product/mittens/):
 * //    "/product/mittens"
 */
exports.slashPath = function() {
    return env.path.replace(/[^\/]+$/, '').replace(/^$/, '/');
};

/**
 * @method absolutize
 * @summary functions
 * @memberof fns
 * @description Converts a given origin URL to a fully-absolutized URL. Returns
 * the input URL if it is already absolutized, or if the address does not
 * reference the origin.
 * @param {String} href A string for the URL to be absolutized.
 * @return {String} A string for the absolutized version of the input URL.
 * @example
 * fns.absolutize("/test1/test2");
 * // => Returns: "//www.mysite.com/test1/test2"
 * @example
 * fns.absolutize("test1");
 * // => Returns (when on http://m.mysite.com):
 * //    "//www.mysite.com/www.mysite.com/test1"
 * // => Returns (when on http://m.mysite.com/test2):
 * //    "//www.mysite.com/www.mysite.com/test1"
 * // => Returns (when on http://m.mysite.com/test2/):
 * //    "//www.mysite.com/www.mysite.com/test2/test1"
 * @example
 * fns.absolutize("www.mysite.com/test");
 * // => Returns: "//www.mysite.com/www.mysite.com/test"
 * @example
 * fns.absolutize("http://www.mysite.com/test");
 * // => Returns (stays the same): "http://www.mysite.com/test"
 * @example
 * fns.absolutize("http://mysite.com/test");
 * // => Returns (stays the same, provided that the naked domain is in your
 * //    moov_config.json): "http://mysite.com/test"
 * @example
 * fns.absolutize("http://mlocal.mysite.com/test");
 * // => Returns (stays the same): "http://mlocal.mysite.com/test"
 * @example
 * fns.absolutize("http://www.google.com/");
 * // => Returns (stays the same, provided that Google is _not_ in your
 * //    moov_config.json): "http://www.google.com/"
 */
exports.absolutize = function(href) {
    href = href.trim();
    if (/^(?![a-zA-Z]+:)(?!\/\/)(?!$)/.test(href)) {
        return '//' + env.source_host + (href[0] === '/' ? '' : exports.slashPath()) + href;
    }
    return href;
};

/**
 * @method absolutizeSrcs
 * @summary functions
 * @memberof fns
 * @description Absolutizes all image and script `src` attribute values.
 * @return {undefined} `undefined`
 * @example
 * fns.absolutizeSrcs();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;script src="/script1.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;img src="http://mysite.com/img1.jpeg" />
 * //      &lt;img src="img2.gif" />
 * //      &lt;script src="//www.mysite.com/script2.js">&lt;/script>
 * //    &lt;/body>
 * // => HTML output (when on http://m.mysite.com/test):
 * //    &lt;head>
 * //      &lt;script src="//www.mysite.com/script1.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;img src="http://mysite.com/img1.jpeg" />
 * //      &lt;img src="//www.mysite.com/test/img2.gif" />
 * //      &lt;script src="//www.mysite.com/script2.js">&lt;/script>
 * //    &lt;/body>
 */
exports.absolutizeSrcs = function() {
    $html.find('img, script').attr('src', function(i, attr) {
        return attr ? exports.absolutize(attr) : null;
    });
};

/**
 * @method rewriteJsSrcs
 * @summary functions
 * @memberof fns
 * @description Rewrites all `src` attributes for `script` elements. Works on
 * HTML fragments, since this navigates from the root element `$root`.
 * @return {undefined} `undefined`
 * @example
 * fns.rewriteJsSrcs();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;script src="/script1.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;img src="http://mysite.com/img1.jpeg" />
 * //      &lt;img src="img2.gif" />
 * //      &lt;script src="//www.mysite.com/script2.js">&lt;/script>
 * //    &lt;/body>
 * // => HTML output (production):
 * //    &lt;head>
 * //      &lt;script src="//m.mysite.com/script1.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;img src="http://mysite.com/img1.jpeg" />
 * //      &lt;img src="img2.gif" />
 * //      &lt;script src="//m.mysite.com/script2.js">&lt;/script>
 * //    &lt;/body>
 */
exports.rewriteJsSrcs = function() {
    $root.find('script').attr('src', function(i, attr) {
        return attr ? exports.rewriteLink(attr) : null;
    });
};

/**
 * @method perfectProxy
 * @summary functions
 * @memberof fns
 * @description Rewrites the `href` links in any `a` elements to point to the
 * Moovweb proxy if it does not already, as well as the `src` attribute for any
 * `script` elements. Relative paths remain, since they are already passing
 * through the Moovweb engine.
 * This uses rewriteLinks() and rewriteJsSrcs().
 * @return {undefined} `undefined`
 * @example
 * fns.perfectProxy();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;script src="/script1.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;a href="test">Test&lt;/a>
 * //      &lt;a href="http://www.mysite.com/test">Test&lt;/a>
 * //      &lt;a href="http://www.google.com/">Test&lt;/a>
 * //      &lt;script src="//www.mysite.com/script2.js">&lt;/script>
 * //      &lt;script src="//www.google.com/script3.js">&lt;/script>
 * //    &lt;/body>
 * // => HTML output (production):
 * //    &lt;head>
 * //      &lt;script src="/script1.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;a href="test">Test&lt;/a>
 * //      &lt;a href="http://m.mysite.com/test">Test&lt;/a>
 * //      &lt;a href="http://www.google.com/">Test&lt;/a>
 * //      &lt;script src="//m.mysite.com/script2.js">&lt;/script>
 * //      &lt;script src="//www.google.com/script3.js">&lt;/script>
 * //    &lt;/body>
 */
exports.perfectProxy = function() {
    exports.rewriteLinks();
    exports.rewriteJsSrcs();
};

/**
 * @method rewriteAspNetScripts
 * @summary functions
 * @memberof fns
 * @description Rewrites only ASP.NET-related scripts, usually for the purpose
 * of access or content rewriting.
 * @return {undefined} `undefined`
 * @example
 * fns.rewriteAspNetScripts();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;script src="//www.mysite.com/script1.js">&lt;/script>
 * //      &lt;script src="//www.mysite.com/ScriptResource.axd?d=long_hash&amp;t=long_hash">&lt;/script>
 * //    &lt;/head>
 * // => HTML output (production):
 * //    &lt;head>
 * //      &lt;script src="//www.mysite.com/script1.js">&lt;/script>
 * //      &lt;script src="//m.mysite.com/ScriptResource.axd?d=long_hash&amp;t=long_hash">&lt;/script>
 * //    &lt;/head>
 */
exports.rewriteAspNetScripts = function() {
    $html.find('script[src*="ScriptResource.axd?"]').attr('src', function(_, attr) {
        return exports.rewriteLink(attr);
    });
};

/**
 * @method removeAllStyles
 * @summary functions
 * @memberof fns
 * @description Removes all `link` and `style` elements.
 * @return {undefined} `undefined`
 * @example
 * fns.removeAllStyles();
 * // => HTML input:
 * //    &lt;head>
 * //     &lt;link rel="stylesheet" href="http://www.mysite.com/my.css" />
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;style>
 * //        body {
 * //          color: red;
 * //        }
 * //      &lt;/style>
 * //    &lt;/body>
 * // => HTML output:
 * //    &lt;head>&lt;/head>
 * //    &lt;body>&lt;/body>
 */
exports.removeAllStyles = function() {
    $html.find('link[rel="stylesheet"]:not([data-mw-keep]), style').remove();
};

/**
 * @method cleanMobileMetaTags
 * @summary functions
 * @memberof fns
 * @description Sanitizes any `meta` tags related to mobile development. This
 * entails resetting any existing `viewport` or `format-detection` meta tags to
 * be Moovweb-specific, in addition to an `http-equiv` tag.
 * @return {undefined} `undefined`
 * @example
 * fns.cleanMobileMetaTags();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;meta name="viewport" id="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,initial-scale=1.0">
 * //      &lt;meta name="format-detection" content="telephone=yes">
 * //    &lt;/head>
 * // => HTML output:
 * //    &lt;head>
 * //      &lt;meta http-equiv="Content-Type" content="text/html">
 * //      &lt;meta name="viewport" id="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
 * //      &lt;meta name="format-detection" content="telephone=no">
 * //    &lt;/head>
 */
exports.cleanMobileMetaTags = function() {
    $head.find('meta[name="viewport"], meta[name="format-detection"]').remove();
    $head.append(
        tag('meta', {'http-equiv': 'Content-Type', content: 'text/html'}),
        tag('meta', {name: 'viewport', content: 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0'}),
        tag('meta', {name: 'format-detection', content: 'telephone=no'})
    );
};

/**
 * @method removeDesktopMobileIcon
 * @summary functions
 * @memberof fns
 * @description Removes any mobile icons on the origin site.
 * @return {undefined} `undefined`
 * @example
 * fns.removeDesktopMobileIcon();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;link rel="shortcut icon" href="http://www.mysite.com/64.png" sizes="64x64">
 * //      &lt;link rel="shortcut icon" href="http://www.mysite.com/128.png" sizes="128x128">
 * //      &lt;link rel="shortcut icon" href="http://www.mysite.com/192.png" sizes="192x192">
 * //      &lt;link rel="apple-touch-icon" href="http://www.mysite.com/76.png" sizes="76x76">
 * //      &lt;link rel="apple-touch-icon" href="http://www.mysite.com/120.png" sizes="120x120">
 * //      &lt;link rel="apple-touch-icon" href="http://www.mysite.com/152.png" sizes="152x152">
 * //      &lt;link rel="apple-touch-icon" href="http://www.mysite.com/180.png" sizes="180x180">
 * //    &lt;/head>
 * // => HTML input:
 * //    &lt;head>&lt;/head>
 */
exports.removeDesktopMobileIcon = function() {
    $head.find('link[rel="apple-touch-icon"], link[rel*="shortcut"][rel*="icon"]').remove();
};

/**
 * @method removeHtmlComments
 * @summary functions
 * @memberof fns
 * @description Removes HTML comments.
 * @return {undefined} `undefined`
 * @example
 * fns.removeHtmlComments();
 * // => HTML input:
 * //    &lt;body>
 * //    &lt;!-- Empty body element -->
 * //    &lt;/body>
 * // => HTML output:
 * //    &lt;body>&lt;/body>
 */
exports.removeHtmlComments = function() {
    function helper(node) {
        var children = node.children;
        if (!children || !children[0]) {
            return;
        }
        for (var i = 0; i &lt; children.length; i++) {
            if (children[i].type === 'comment') {
                $(children[i]).remove();
            }
            else if (children[i].type === 'tag') {
                helper(children[i]);
            }
        }
    }
    helper($root[0]);
};

/**
 * @method sass
 * @summary functions
 * @memberof fns
 * @description Retrieves the URL for the specified Sass asset path, which
 * changes depending upon the project environment.
 * @param {String} baseName A string for the relative path to the asset file.
 * Must be relative to the &lt;em>assets/stylesheets&lt;/em> directory in your project
 * structure.
 * @return {String} A string containing the URL for the compiled CSS asset.
 * @example
 * $head.append(tag("link", {rel: "stylesheet", type: "text/css", href: fns.sass("main")}));
 * // => HTML input:
 * //    &lt;head>&lt;/head>
 * // => HTML output (local):
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" type="text/css" href="//mlocal.mysite.com/_moovweb_local_assets_/stylesheets/.css/main.css">
 * //    &lt;/head>
 * // => HTML output (production):
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" type="text/css" href="//assets.moovweb.net/project-uid/mode-uid/build-version/stylesheets/.css/main.css">
 * //    &lt;/head>
 */
exports.sass = function(baseName) {
    return exports.asset(path.join('stylesheets/.css/', baseName + '.css'));
};

/**
 * @method addAssets
 * @summary functions
 * @memberof fns
 * @description Adds JavaScript and Sass assets. Sass assets get a
 * `data-mw-keep="true"` attribute-value pair added, and script assets get a
 * `data-keep="true"` pair added.
 * @return {undefined} `undefined`
 * @example
 * fns.addAssets();
 * // => HTML input:
 * //    &lt;head>&lt;/head>
 * //    &lt;body>&lt;/body>
 * // => HTML output (local):
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" type="text/css" href="//mlocal.mysite.com/_moovweb_local_assets_/stylesheets/.css/main.css" data-mw-keep="true">
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;script data-keep="true" type="text/javascript" src="//mlocal.mysite.com/_moovweb_local_assets_/javascript/main.js">&lt;/script>
 * //    &lt;/body>
 * // => HTML output (production):
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" type="text/css" href="//assets.moovweb.net/project-uid/mode-uid/build-version/stylesheets/.css/main.css">
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;script data-keep="true" type="text/javascript" src="//assets.moovweb.net/project-uid/mode-uid/build-version/javascript/main.js">&lt;/script>
 * //    &lt;/body>
 */
exports.addAssets = function() {
    $head.append(tag('link', {rel: 'stylesheet', type: 'text/css', href: exports.sass('main'), 'data-mw-keep': 'true'}));
    $body.append(tag('script', {'data-keep': 'true', type: 'text/javascript', src: exports.asset('javascript/main.js')}));
};

/**
 * @method removeDesktopJs
 * @summary functions
 * @memberof fns
 * @description Removes non-ASP.NET desktop scripts that aren't explicitly
 * specified to be removed (using the `data-keep` attribute).
 * @return {undefined} `undefined`
 * @example
 * fns.removeDesktopJs();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;script type="text/javascript" src="/script1.js">&lt;/script>
 * //      &lt;script data-keep="true" type="text/javascript" src="/script2.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;script data-keep="false" type="text/javascript" src="/script3.js">&lt;/script>
 * //      &lt;script data-keep="true" type="text/javascript" src="/script4.js">&lt;/script>
 * //    &lt;/body>
 * // => HTML output:
 * //    &lt;head>
 * //      &lt;script data-keep="true" type="text/javascript" src="/script2.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;script data-keep="true" type="text/javascript" src="/script4.js">&lt;/script>
 * //    &lt;/body>
 * @example
 * fns.removeDesktopJs();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;script src="//m.mysite.com/ScriptResource.axd?d=long_hash&amp;t=long_hash">&lt;/script>
 * //    &lt;/head>
 * // => HTML output (stays the same):
 * //    &lt;head>
 * //      &lt;script src="//m.mysite.com/ScriptResource.axd?d=long_hash&amp;t=long_hash">&lt;/script>
 * //    &lt;/head>
 *
 */
exports.removeDesktopJs = function() {
    $html.find('script[src]').each(function(/* i, elem */) {
        if ((!$(this).attr('data-keep') || $(this).attr('data-keep') === 'false') &amp;&amp; !/ScriptResource\.axd/.test($(this).attr('src'))) {
            $(this).remove();
        }
    });
};

/**
 * @method isRobots
 * @summary functions
 * @memberof fns
 * @description Checks if the current path is /robots.txt.
 * @return {Boolean} A boolean for whether the current path is /robots.txt.
 * @example
 * fns.isRobots();
 * // => Returns (if on /robots.txt): true
 */
exports.isRobots = function() {
    return (/\/robots\.txt/).test(env.path);
};

/**
 * @method handleRobots
 * @summary functions
 * @memberof fns
 * @description Disallows robot crawling for non-production environments.
 * Retains origin production robot crawling settings for transformed production
 * environments.
 * @param {String} body A string containing the original robots.txt response.
 * @return {String} A string for the possibly-modified outgoing robots.txt
 * response.
 * @example
 * fns.handleRobots("User-agent: *\nDisallow: /account.php\nDisallow: /cart.php");
 * // => Returns (local, stage): "
 * //      User-agent: *
 * //      Disallow: /
 * //    "
 * // => Returns (production; stays the same): "
 * //      User-agent: *
 * //      Disallow: /account.php
 * //      Disallow: /cart.php
 * //    "
 */
exports.handleRobots = function(body) {
    var isProd = /^(m\.|t\.)/;

    if (isProd.test(env.host)) {
        return body;
    }
    return 'User-agent: *\nDisallow: /';
};

/**
 * @method relocateScripts
 * @summary functions
 * @memberof fns
 * @description Moves `script` elements to the bottom of the `body`, retaining
 * the original sequential order.
 * @return {undefined} `undefined`
 * @example
 * fns.relocateScripts();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;script type="text/javascript" src="/script1.js">&lt;/script>
 * //      &lt;meta name="viewport" id="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,initial-scale=1.0">
 * //      &lt;script type="text/javascript" src="/script2.js">&lt;/script>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;script type="text/javascript" src="/script3.js">&lt;/script>
 * //      &lt;div>&lt;/div>
 * //      &lt;script type="text/javascript" src="/script4.js">&lt;/script>
 * //    &lt;/body>
 * // => HTML output:
 * //    &lt;head>
 * //      &lt;meta name="viewport" id="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,initial-scale=1.0">
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;div>&lt;/div>
 * //      &lt;script type="text/javascript" src="/script1.js">&lt;/script>
 * //      &lt;script type="text/javascript" src="/script2.js">&lt;/script>
 * //      &lt;script type="text/javascript" src="/script3.js">&lt;/script>
 * //      &lt;script type="text/javascript" src="/script4.js">&lt;/script>
 * //    &lt;/body>
 */
exports.relocateScripts = function() {
    $body.append($html.find('script'));
};

// Layers

/**
 * @method queryLayerText
 * @summary functions
 * @memberof fns
 * @description Indicates whether or not the specified layer is active, with
 * the indicator as a string.
 * @param {String} layer A string for the name of the layer to query.
 * @return {String} A string for a boolean number, i.e. "1" if layer is active,
 * "0" otherwise.
 * @example
 * fns.queryLayerText("tablet");
 * // => Returns (if tablet layer is active): "1"
 * // => Returns (if tablet layer is not active): "0"
 */
exports.queryLayerText = function(layer) {
    return layers.indexOf(layer) >= 0 ? '1' : '0';
};


/**
 * @method activeLayers
 * @summary functions
 * @memberof fns
 * @description Retrieves a list of active layers used to transform the project.
 * @return {Array} An array of strings representing each active layer.
 * @example
 * fns.activeLayers();
 * // => Context: Project has multiple layers, presumably for tests, called
 * //    "testA", "testB", "testC", and "testD." User starts a server running
 * //    only the "testA" and "testC" layers.
 * // => Returns: ["testA", "testC"]
 */
exports.activeLayers = function() {
    return layers;
};

/**
 * @method layer
 * @summary functions
 * @memberof fns
 * @description Indicates whether or not the specified layer is active, with
 * the indicator as a boolean.
 * @param {String} layer A string for the name of the layer to query.
 * @return {Boolean} A boolean for whether the layer is active.
 * @example
 * fns.layer("tablet");
 * // => Returns (if tablet layer is active): true
 * // => Returns (if tablet layer is not active): false
 */
exports.layer = function(layer) {
    return exports.queryLayerText(layer) === '1';
};

/**
 * @method layerNot
 * @summary functions
 * @memberof fns
 * @description Indicates whether or not the specified layer is inactive, with
 * the indicator as a boolean.
 * @param {string} layer A string for the name of the layer to query.
 * @return {boolean} A boolean for whether the layer is inactive.
 * @example
 * fns.layerNot("tablet");
 * // => Returns (if tablet layer is active): false
 * // => Returns (if tablet layer is not active): true
 */
exports.layerNot = function(layer) {
    return exports.queryLayerText(layer) === '0';
};

/**
 * @method onDevelopment
 * @summary functions
 * @memberof fns
 * @description Runs a callback function if the project is being run on a
 * development environment.
 * @param {Function} callback A callback function to run if the project is
 * being run on a development environment.
 * @return {Boolean} A boolean indicating whether the project is being run on
 * a development environment (and by extension, whether the callback functoin
 * was run).
 * @example
 * fns.onDevelopment(function() {
 *   $body.append(tag("div"));
 * });
 * // => HTML input:
 * //    &lt;body>&lt;/body>
 * // => HTML input (local):
 * //    &lt;body>
 * //      &lt;div>&lt;/div>
 * //    &lt;/body>
 * // => HTML output (production; stays the same):
 * //    &lt;body>&lt;/body>
 */
exports.onDevelopment = function(callback){
    if (process.env.NODE_ENV === 'development'){
        if (typeof(callback) === 'function') {
            callback();
        }
        return true;
    }
    return false;
};

// Assert

/**
 * @method assert
 * @summary functions
 * @memberof fns
 * @description Make an assertion for conditional statement and run the callback
 * if the statement is correct. Generallyu used to evaluate expressions and
 * throw exceptions when developing locally.
 * @param {Boolean} conditional A boolean for whether the callback should run.
 * Usually should take the form of a full conditional statement.
 * @param {Function} callback A callback function to run if the conditional is
 * true.
 * @return {Boolean} A boolean for the original condition.
 * @example
 * fns.assert($body.children().length > 0, function() {
 *   console.log("The body is nonempty.");
 * });
 * // => HTML input:
 * //    &lt;body>&lt;/body>
 * // => Throws (local): generic JavaScript Error, with broken page functionality.
 * // => Returns (production): false
 * @example
 * fns.assert($body.children().length === 0, function() {
 *   console.log("The body is empty.");
 * });
 * // => HTML input:
 * //    &lt;body>&lt;/body>
 * // => Logs: "The body is empty."
 * // => Returns: true
 */
exports.assert = function(conditional, callback) {
    var failed = !conditional;
    exports.onDevelopment(function(){
        if (failed) {
            var error = new Error('Assert failed');
            throw error.stack;
        } else {
            if (typeof(callback) === 'function') {
                callback();
            }
        }
    });

    return !failed;
};

/**
 * @method moveStylesAboveScripts
 * @summary functions
 * @memberof fns
 * @description Move `style` and `link` elements above the `script` elements.
 * @return {Object} A Cheerio object for the first `script` element found in the
 * HTML.
 * @example
 * fns.moveStylesAboveScripts();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" href="/styles.scss">
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;script type="text/javascript" src="/script1.js">&lt;/script>
 * //      &lt;style>
 * //        body {
 * //          color: red;
 * //        }
 * //      &lt;/style>
 * //      &lt;script type="text/javascript" src="/script2.js">&lt;/script>
 * //    &lt;/body>
 * // => Returns: Cheerio object associated with the "script1.js" `script`
 * //    element.
 * // => HTML output:
 * //    &lt;head>&lt;/head>
 * //    &lt;body>
 * //      &lt;link rel="stylesheet" href="/styles.scss">
 * //      &lt;style>
 * //        body {
 * //          color: red;
 * //        }
 * //      &lt;/style>
 * //      &lt;script type="text/javascript" src="/script1.js">&lt;/script>
 * //      &lt;script type="text/javascript" src="/script2.js">&lt;/script>
 * //    &lt;/body>
 */
exports.moveStylesAboveScripts = function() {
    var styles = $html.find('[rel~=stylesheet], style');
    return $html.find('script').closest('script').first().before(styles);
};

/**
 * @method moveStylesToHead
 * @summary functions
 * @memberof fns
 * @description Prepend `style` and `link` elements to the `head`. To be used
 * in conjuction (after) the moveStylesAboveScripts() method, which takes
 * effect if there is no `script` elements in the `head` (this is otherwise
 * redundant if the first `script` is already there).
 * @return {Object} A Cheerio object associated with the `head` element.
 * @example
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" href="/styles.scss">
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;script type="text/javascript" src="/script1.js">&lt;/script>
 * //      &lt;style>
 * //        body {
 * //          color: red;
 * //        }
 * //      &lt;/style>
 * //      &lt;script type="text/javascript" src="/script2.js">&lt;/script>
 * //    &lt;/body>
 * // => Returns: Cheerio object associated with the `head` element
 * // => HTML output:
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" href="/styles.scss">
 * //      &lt;style>
 * //        body {
 * //          color: red;
 * //        }
 * //      &lt;/style>
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;script type="text/javascript" src="/script3.js">&lt;/script>
 * //      &lt;script type="text/javascript" src="/script4.js">&lt;/script>
 * //    &lt;/body>
 */
exports.moveStylesToHead = function() {
    var styles = $html.find('[rel~=stylesheet], style');
    return $head.prepend(styles);
};

/**
 * @method insertSubresource
 * @summary functions
 * @memberof fns
 * @description Inserts an asset as a subresource to enable early loading of
 * resources within the current page. For more on subresources, see the
 * &lt;a href="https://www.chromium.org/spdy/link-headers-and-server-hint/link-rel-subresource">Chromium
 * documentation&lt;/a>.
 * @param {String} resource A string for the href value to be used as a
 * subresource.
 * @return {Object} A Cheerio object associated with the newly-inserted
 * subresource element.
 * @example
 * fns.insertSubresource("http://www.google.com/script1.js");
 * // => HTML input:
 * //    &lt;head>&lt;/head>
 * // => Returns: DOM object associated with the newly-created subresource
 * //    element.
 * // => HTML output:
 * //    &lt;head>
 * //      &lt;link rel="subresource" href="http://www.google.com/script1.js">
 * //    &lt;/head>
 */
exports.insertSubresource = function(resource) {
    if (resource === undefined) {
        return undefined;
    }
    else {
        var subresource = tag('link', {rel: 'subresource', href: resource});
        $head.append(subresource);
        return subresource;
    }
};

function gatherHosts(selection, attribute, hosts) {
   // Gather hosts based on selection and attribute.
   // - selection: string for a selector of elements
   // - attribute: string for the attribute of each element to check
   // - hosts: array of strings for hosts
   // - returns: array of strings for new hosts
    var host, hostSelector = /^((https?:)?\/\/.*?)(\/.*|$)/;
    if (hosts===undefined) {
        hosts = {};
    }
    $html.find(selection).each(function() {
        if (hostSelector.test(this.attribs[attribute])) {
            host = hostSelector.exec(this.attribs[attribute]);
            if (host[1] !== undefined) {
                hosts[host[1]] = true;
            }
        }
    });
    return hosts;
}

/**
 * @method insertDnsPrefetch
 * @summary functions
 * @memberof fns
 * @description Insert DNS prefetch elements to the `head`, allowing to resolve
 * DNSs before the referenced items are needed. Note that the order of the
 * generated prefetch tags may not be in the same order as the asset order.
 * @return {undefined} `undefined`
 * @example
 * fns.insertDnsPrefetch();
 * // => HTML input:
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" href="http://www.twitter.com/stylesheet1.css">
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;a href="http://www.bing.com/">&lt;/a>
 * //      &lt;img src="http://www.yahoo.com/">&lt;/a>
 * //      &lt;script type="text/javascript" src="http://www.google.com/script1.js">&lt;/a>
 * //    &lt;/body>
 * // => HTML output:
 * //    &lt;head>
 * //      &lt;link rel="stylesheet" href="http://www.twitter.com/stylesheet1.css">
 * //      &lt;link rel="dns-prefetch" href="http://www.yahoo.com/">
 * //      &lt;link rel="dns-prefetch" href="http://www.google.com/">
 * //      &lt;link rel="dns-prefetch" href="http://www.twitter.com/">
 * //      &lt;link rel="dns-prefetch" href="http://www.bing.com/">
 * //    &lt;/head>
 * //    &lt;body>
 * //      &lt;a href="http://www.facebook.com/">&lt;/a>
 * //      &lt;img src="http://www.microsoft.com/img1.js" />
 * //      &lt;script type="text/javascript" src="http://www.google.com/script1.js">&lt;/a>
 * //    &lt;/body>
 */
exports.insertDnsPrefetch = function() {
    var domains = gatherHosts('img, script', 'src', {});
    gatherHosts('a, link', 'href', domains);

    for (var d in domains) {
        if (domains.hasOwnProperty(d)) {
            var prefetch = tag('link', {rel: 'dns-prefetch', href: d});
            $head.append(prefetch);
        }
    }
};

/**
 * @method setPageType
 * @summary functions
 * @memberof fns
 * @description Sets the internal `pageType` property for the environment `env`.
 * In production, this is specifically used for writing in the "pageType" field
 * on the Moovweb Control Center's Stack Trace feature.
 * @param {string} type A string for the name of the `pageType` to set.
 * @return {undefined} `undefined`
 * @example
 * fns.setPageType(routes.pageType.name);
 * // => Result: Stack Trace reads the `pageType` as "home".
 * // => Note: Already included in the generator's fns.constructPageType()
 * //    method call.
 */
exports.setPageType = function(type) {
    if (typeof(type) === 'string' &amp;&amp; type.length &lt;= 256) {
        exports.export('pageType', type);
    } else {
        console.log('Invalid pageType: ' + type + '! It must be a string with a max length of 256.');
    }
};

/**
 * @method getPageType
 * @summary functions
 * @memberof fns
 * @description Access the internal `pageType` property of the environment
 * `env`, for the given address.
 * @return {String} A string for the name of the given address's `pageType`.
 * @example
 * fns.getPageType();
 * // => Returns: name for the pageType, e.g. "home"
 */
exports.getPageType = function() {
    return env.pageType;
};

/**
 * @method highlightDevelopment
 * @summary functions
 * @memberof fns
 * @description Inserts a banner on the page when developing locally. This
 * allows for a clear differentiation between the proxied single domain site and
 * the original site. Alias for the legacy fns.highlight_development() method.
 * @param {string} [position] A string for the position to place the banner ("top"
 * or "bottom"). Defaults to bottom positioning if "top" is not specified.
 * @return {undefined} `undefined`
 * @example
 * fns.highlightDevelopment("top");
 * // => HTML output: (omitted).
 */
exports.highlightDevelopment = exports.highlight_development = function(position) {
  if (position !== 'top') {
    position  = 'bottom';
  }

  if (env.node_env === 'development') {
   let script = banner.developmentBanner(project, layers, position);
   $html.append(script);
  }
};

/**
 * @method highlightPreview
 * @summary functions
 * @memberof fns
 * @description Inserts a banner on the page if viewing a preview mode. This
 * allows for a clear differentiation between preview modes and live modes.
 * Alias for the legacy fns.highlight_preview() method.
 * @param {string} [position] A string for the position to place the banner ("top"
 * or "bottom"). Defaults to bottom positioning if "top" is not specified.
 * @example
 * fns.highlightPreview("top");
 * // => HTML output: (omitted).
 */
exports.highlightPreview = exports.highlight_preview = function(position) {
  if (position !== 'top') {
    position  = 'bottom';
  }

  if (env.moov_mode_status === 'preview') {
    let script = banner.previewBanner(env.host, env.moov_mode_name, position);
    $html.append(script);
  }
};

module.exports = exports;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    <i>Last updated Thu Sep 29 2016 19:07:23 GMT+0000 (UTC)</i>
</footer>

<script>prettyPrint();</script>
</body>
