<body>

<div data-section="accordion" id="content-nav">
  <section>
      <ul class="doc-sidebar" data-section-content data-section="accordion" id="content-sidebar"><section><a href="#" data-section-title>Classes</a><ul data-section-content data-section="accordion" ><section><a href="module_headerset_HeaderSet" class="" data-section-title>HeaderSet</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_headerset_HeaderSet#addHeader">addHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet#header">header</a></li><li data-type='method'><a href="module_headerset_HeaderSet#removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module_headerset_HeaderSet#removeHeader">removeHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet#toString">toString</a></li></ul></section></ul></section><section><a href="#" data-section-title>Modules</a><ul data-section-content data-section="accordion" ><section><a href="module_functions" class="" data-section-title>functions</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_functions#.absolutize">absolutize</a></li><li data-type='method'><a href="module_functions#.absolutizeSrcs">absolutizeSrcs</a></li><li data-type='method'><a href="module_functions#.activeLayers">activeLayers</a></li><li data-type='method'><a href="module_functions#.addAssets">addAssets</a></li><li data-type='method'><a href="module_functions#.addCanonicalTag">addCanonicalTag</a></li><li data-type='method'><a href="module_functions#.assert">assert</a></li><li data-type='method'><a href="module_functions#.asset">asset</a></li><li data-type='method'><a href="module_functions#.cleanMobileMetaTags">cleanMobileMetaTags</a></li><li data-type='method'><a href="module_functions#.getPageType">getPageType</a></li><li data-type='method'><a href="module_functions#.handleRobots">handleRobots</a></li><li data-type='method'><a href="module_functions#.insertDnsPrefetch">insertDnsPrefetch</a></li><li data-type='method'><a href="module_functions#.insertSubresource">insertSubresource</a></li><li data-type='method'><a href="module_functions#.isRobots">isRobots</a></li><li data-type='method'><a href="module_functions#.layer">layer</a></li><li data-type='method'><a href="module_functions#.layerNot">layerNot</a></li><li data-type='method'><a href="module_functions#.moveStylesAboveScripts">moveStylesAboveScripts</a></li><li data-type='method'><a href="module_functions#.moveStylesToHead">moveStylesToHead</a></li><li data-type='method'><a href="module_functions#.onDevelopment">onDevelopment</a></li><li data-type='method'><a href="module_functions#.perfectProxy">perfectProxy</a></li><li data-type='method'><a href="module_functions#.queryLayerText">queryLayerText</a></li><li data-type='method'><a href="module_functions#.relocateScripts">relocateScripts</a></li><li data-type='method'><a href="module_functions#.removeAllStyles">removeAllStyles</a></li><li data-type='method'><a href="module_functions#.removeDesktopJs">removeDesktopJs</a></li><li data-type='method'><a href="module_functions#.removeDesktopMobileIcon">removeDesktopMobileIcon</a></li><li data-type='method'><a href="module_functions#.removeHtmlComments">removeHtmlComments</a></li><li data-type='method'><a href="module_functions#.rewriteAspNetScripts">rewriteAspNetScripts</a></li><li data-type='method'><a href="module_functions#.rewriteJsSrcs">rewriteJsSrcs</a></li><li data-type='method'><a href="module_functions#.rewriteLink">rewriteLink</a></li><li data-type='method'><a href="module_functions#.rewriteLinks">rewriteLinks</a></li><li data-type='method'><a href="module_functions#.rewriteToProxy">rewriteToProxy</a></li><li data-type='method'><a href="module_functions#.sass">sass</a></li><li data-type='method'><a href="module_functions#.setPageType">setPageType</a></li><li data-type='method'><a href="module_functions#~gatherHosts">gatherHosts</a></li></ul></section><li><a href="module_headerset">headerset</a></li><li><a href="module_stdlib">stdlib</a></li></ul></section><section><a href="#" data-section-title>Namespaces</a><ul data-section-content data-section="accordion" ><section><a href="module_headerset_HeaderSet_fns" class="" data-section-title>fns</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_headerset_HeaderSet_fns#.addHeader">addHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.header">header</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.method">method</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.method">method</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.path">path</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.path">path</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.removeHeader">removeHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusCode">statusCode</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusCode">statusCode</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusText">statusText</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusText">statusText</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.versionMinor">versionMinor</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.versionMinor">versionMinor</a></li></ul></section><section><a href="module_stdlib_stdlib" class="" data-section-title>stdlib</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_stdlib_stdlib#.addCookie">addCookie</a></li><li data-type='method'><a href="module_stdlib_stdlib#.export">export</a></li><li data-type='method'><a href="module_stdlib_stdlib#.init$">init$</a></li><li data-type='method'><a href="module_stdlib_stdlib#.scoped$">scoped$</a></li></ul></section></ul></section><section><a href="#" data-section-title>Global</a><ul data-section-content data-section="accordion"><li><a href="global#breakpoint">breakpoint</a></li><li><a href="global#env">env</a></li><li><a href="global#layers">layers</a></li><li><a href="global#rules">rules</a></li><li><a href="global#tag">tag</a></li><li><a href="global#txt">txt</a></li></ul></section></ul>
  </section>
</div>

<div id="main">
    
    <h1 class="page-title">stdlib.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* globals $this, cheerio, env, head, html, root, scoped$ */
/* exported PROXY_TO_UPSTREAM */

'use strict';

/**
 * @module stdlib
 */
const PROXY_TO_UPSTREAM = 1;

/**
 * Exports function
 * @param {Object} ctxObj
 */
module.exports = function(ctxObj) {
    // grabbing required keys from Hash (env, rules, and exports)
    /** @global */
    global.env = ctxObj.env;
    /** @global */
    global.rules = ctxObj.rules;
    /** @global */
    global.layers = ctxObj.layers || [];
    if (ctxObj.env.node_env !== undefined) {
        process.env.NODE_ENV = ctxObj.env.node_env;
    }
    let exports = ctxObj.exports;
    // use env, rules, and exports to setup user VM context
    /**
     * @namespace
     */
    let stdlib = require('./functions.js');

    /**
     * Export value.
     * @function
     * @param {string} key
     * @param {string} val
     */
    stdlib.export = function(key, val) {
        exports.push([key, val]);
        env[key] = val;
    };

    /**
     * Add cookie.
     * @function
     * @param {string} name
     * @param {string} value
     * @param {string} domain
     * @param {string} path
     * @param {string} expires
     * @param {boolean} secure
     * @param {boolean} httpOnly
     */
    stdlib.addCookie = function(name, value, domain, path, expires, secure, httpOnly) {
        let raw = name + '=' + value;
        if (domain) {
            raw += '; domain=' + domain;
        }
        if (path) {
            raw += '; path=' + path;
        }
        if (expires) {
            raw += '; expires=' + expires;
        }
        if (secure) {
            raw += '; secure';
        }
        if (httpOnly) {
            raw += '; httponly';
        }
        stdlib.export('__cookie__', env.__cookie__ + '\r\nSet-Cookie: ' + raw);
    };

    /**
     * Scoped$.
     * @function
     * @param {Object} $
     * @returns {Object} Return proxy.
     */
    stdlib.scoped$ = function($) {
        global.$child = function(sel, fn) {
            if (typeof sel === 'function') {
                fn = sel;
                sel = null;
            }
            return proxy($this.children(sel), fn);
        };

        var proxy = function(selector, context /* , root */ ) {
            if (typeof context !== 'function') {
                return $.apply(this, arguments);
            }
            var query = scoped$(selector);
            return query.each(function() {
                var $this = scoped$(this);

                var _$ = global.scoped$;
                var _$this = global.$this;

                // new nested $
                global.scoped$ = function(sel, fn) {
                    return proxy($(sel, query), fn);
                };
                global.$this = $this;

                var ret = context.call($this);
                global.scoped$ = _$;
                global.$this = _$this;
                return ret;
            });
        };

        proxy.$ = $; // keep original cheerio function
        Object.keys($).forEach(function(i) {
            proxy[i] = $[i];
        });
        return proxy;
    };

    /**
     * Initialize $.
     * @function
     * @param {string} body Content.
     * @param {Object} opts
     */
    stdlib.init$ = function(body, opts) {
        var $ = cheerio.load(body, opts);
        global.root = $.root();
        global = root.children('html');
        global.head = html.children('head');
        global.body = html.children('body');
        global.scoped$ = stdlib.scoped$($);
        global.$ = $;
        return {
            $: $,
            scoped$: scoped$,
            root: root,
            html: html,
            head: head,
            body: body
        };
    };

    return stdlib;
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Tue Oct 27 2015 01:02:48 GMT+0000 (UTC)
</footer>

<script>prettyPrint();</script>
</body>
