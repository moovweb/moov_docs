<body>

<div class="split-container">
  <div data-section="accordion" id="content-nav" class="module-nav media">
    <div class="module-sidebar" id="content-sidebar"><div class='sidebar-head'>moov_stdlib</div><div class='sidebar-body'><a href='/modules/moov_stdlib/index' class='L1'>README</a><div class='L1-container'><div class='L1-button'><a href="fns.html" class="L1">fns Namespace</a></div><ul class='methods L1-content'><li data-type='method'><a href="fns#.absolutize" class="L1">.absolutize()</a></li><li data-type='method'><a href="fns#.absolutizeSrcs" class="L1">.absolutizeSrcs()</a></li><li data-type='method'><a href="fns#.activeLayers" class="L1">.activeLayers()</a></li><li data-type='method'><a href="fns#.addAssets" class="L1">.addAssets()</a></li><li data-type='method'><a href="fns#.addCanonicalTag" class="L1">.addCanonicalTag()</a></li><li data-type='method'><a href="fns#.addCookie" class="L1">.addCookie()</a></li><li data-type='method'><a href="fns#.assert" class="L1">.assert()</a></li><li data-type='method'><a href="fns#.asset" class="L1">.asset()</a></li><li data-type='method'><a href="fns#.cleanMobileMetaTags" class="L1">.cleanMobileMetaTags()</a></li><li data-type='method'><a href="fns#.export" class="L1">.export()</a></li><li data-type='method'><a href="fns#.getModeInfoFromModeName" class="L1">.getModeInfoFromModeName()</a></li><li data-type='method'><a href="fns#.getPageType" class="L1">.getPageType()</a></li><li data-type='method'><a href="fns#.handleRobots" class="L1">.handleRobots()</a></li><li data-type='method'><a href="fns#.highlightDevelopment" class="L1">.highlightDevelopment()</a></li><li data-type='method'><a href="fns#.highlightPreview" class="L1">.highlightPreview()</a></li><li data-type='method'><a href="fns#.init$" class="L1">.init$()</a></li><li data-type='method'><a href="fns#.injectDebuggingInfo" class="L1">.injectDebuggingInfo()</a></li><li data-type='method'><a href="fns#.insertDnsPrefetch" class="L1">.insertDnsPrefetch()</a></li><li data-type='method'><a href="fns#.insertSubresource" class="L1">.insertSubresource()</a></li><li data-type='method'><a href="fns#.isRobots" class="L1">.isRobots()</a></li><li data-type='method'><a href="fns#.layer" class="L1">.layer()</a></li><li data-type='method'><a href="fns#.layerNot" class="L1">.layerNot()</a></li><li data-type='method'><a href="fns#.moveStylesAboveScripts" class="L1">.moveStylesAboveScripts()</a></li><li data-type='method'><a href="fns#.moveStylesToHead" class="L1">.moveStylesToHead()</a></li><li data-type='method'><a href="fns#.onDevelopment" class="L1">.onDevelopment()</a></li><li data-type='method'><a href="fns#.perfectProxy" class="L1">.perfectProxy()</a></li><li data-type='method'><a href="fns#.queryLayerText" class="L1">.queryLayerText()</a></li><li data-type='method'><a href="fns#.relocateScripts" class="L1">.relocateScripts()</a></li><li data-type='method'><a href="fns#.removeAllStyles" class="L1">.removeAllStyles()</a></li><li data-type='method'><a href="fns#.removeDesktopJs" class="L1">.removeDesktopJs()</a></li><li data-type='method'><a href="fns#.removeDesktopMobileIcon" class="L1">.removeDesktopMobileIcon()</a></li><li data-type='method'><a href="fns#.removeHtmlComments" class="L1">.removeHtmlComments()</a></li><li data-type='method'><a href="fns#.rewriteAspNetScripts" class="L1">.rewriteAspNetScripts()</a></li><li data-type='method'><a href="fns#.rewriteJsSrcs" class="L1">.rewriteJsSrcs()</a></li><li data-type='method'><a href="fns#.rewriteLink" class="L1">.rewriteLink()</a></li><li data-type='method'><a href="fns#.rewriteLinks" class="L1">.rewriteLinks()</a></li><li data-type='method'><a href="fns#.rewriteToProxy" class="L1">.rewriteToProxy()</a></li><li data-type='method'><a href="fns#.sass" class="L1">.sass()</a></li><li data-type='method'><a href="fns#.scoped$" class="L1">.scoped$()</a></li><li data-type='method'><a href="fns#.setPageType" class="L1">.setPageType()</a></li><li data-type='method'><a href="fns#.slashPath" class="L1">.slashPath()</a></li></ul></div><div class='L1-container'><div class='L1-button'><a href="headers.html" class="L1">headers Namespace</a></div><ul class='methods L1-content'><li data-type='method'><a href="headers#.method" class="L1">.method</a></li><li data-type='method'><a href="headers#.path" class="L1">.path</a></li><li data-type='method'><a href="headers#.statusCode" class="L1">.statusCode</a></li><li data-type='method'><a href="headers#.statusText" class="L1">.statusText</a></li><li data-type='method'><a href="headers#.versionMinor" class="L1">.versionMinor</a></li><li data-type='method'><a href="headers#.addHeader" class="L1">.addHeader()</a></li><li data-type='method'><a href="headers#.header" class="L1">.header()</a></li><li data-type='method'><a href="headers#.headerKeys" class="L1">.headerKeys()</a></li><li data-type='method'><a href="headers#.removeAllHeaders" class="L1">.removeAllHeaders()</a></li><li data-type='method'><a href="headers#.removeCookie" class="L1">.removeCookie()</a></li><li data-type='method'><a href="headers#.removeHeader" class="L1">.removeHeader()</a></li><li data-type='method'><a href="headers#.removeSetCookie" class="L1">.removeSetCookie()</a></li></ul></div><div class="L1-container"><div class="L1-button"><a href="/modules/moov_stdlib/global" class="L1"><em>Global</em> Namespace</a></div><ul class="L1-content"><li><a href="global#breakpoint" class="L1">breakpoint</a></li><li><a href="global#tag" class="L1">tag</a></li><li><a href="global#txt" class="L1">txt</a></li></ul></div></div></div>
  </div>

  <div id="main" class="module-content data">
      
      <div class="breadcrumbs">
        <a href="/">Home</a>
        &raquo; <a href="/docs">Documentation</a>
        &raquo; <a href="/modules/moov_stdlib/index">moov_stdlib</a>
        &raquo; headerset.js
      </div>
      <h1 class="page-title">headerset.js</h1>
      

      



    
    <section>
        <article>
            <pre class="source"><code class="language-javascript">'use strict';

const REQ_REGEX = /^([A-Z]+)\s+(.+)\s+HTTP\/1.([01])$/m;
const RES_REGEX = /^HTTP\/1.([01]) (\d{3}) ([^\n\r]+)$/m;

/**
 * Header manipulation getters, setters, and methods to be used from within
 * moov_request_header_transform.js (for upstream request headers) or
 * moov_response_header_transform.js (for transformed response headers).
 * @namespace headers
 */
function HeaderSet(type, rawHeaders) {
    this.type = type;
    this.fields = [];
    this.hlookup = {};
    let matches;
    if (type === 'request') {
        matches = rawHeaders.match(REQ_REGEX);
        this.method = matches[1];
        this.path = matches[2];
        this.versionMinor = matches[3];
    } else if (type === 'response') {
        matches = rawHeaders.match(RES_REGEX);
        this.versionMinor = matches[1];
        this.statusCode = matches[2];
        this.statusText = matches[3];
    }

    let headerExp = /^([^:\s]*): *(.*)$/mg; // local since it contains unique state
    headerExp.lastIndex = matches[0].length;
    while ((matches = headerExp.exec(rawHeaders))) {
        this.hlookup[matches[1].toLowerCase()] = this.fields.length;
        this.fields.push([matches[1], matches[2]]);
    }

    let self = this;

    this.fns = {
        get method() {
            return self.method;
        },
        get path() {
            return self.path;
        },
        get versionMinor() {
            return self.versionMinor;
        },
        get statusCode() {
            return self.statusCode;
        },
        get statusText() {
            return self.statusText;
        },
        /**
         * @member method
         * @summary headerset
         * @memberof headers
         * @description Gets or sets the request method (request only).
         * @example
         * headers.method = 'POST';
         * // => Result: Moovweb goes upstream with a POST request method.
         * headers.method;
         * // => Returns: 'POST'
         */
        set method(val) {
            self.method = val;
        },
        /**
         * @member path
         * @summary headerset
         * @memberof headers
         * @description Gets or sets the request URL (request only).
         * @example
         * headers.path = '/test-page';
         * // => Result: Moovweb goes upstream requesting the /test-page URL, even if
         * //    the user requested another page. headers.path;
         * // => Returns: '/test-page'
         */
        set path(val) {
            self.path = val;
        },
        /**
         * @member versionMinor
         * @summary headerset
         * @memberof headers
         * @description Gets or sets the HTTP minor version.
         * @example
         * headers.versionMinor = '0';
         * // => Result: Moovweb modifies the request or response to use HTTP/1.0.
         * headers.versionMinor;
         * // => Returns: '0'
         */
        set versionMinor(val) {
            self.versionMinor = val;
        },
        /**
         * @member statusCode
         * @summary headerset
         * @memberof headers
         * @description Gets or sets the status code (response only).
         * @example
         * headers.statusCode = '600';
         * // => Result: Moovweb modifies the response to return a 600 status code.
         * headers.statusCode;
         * // => Returns: '600'
         */
        set statusCode(val) {
            self.statusCode = val;
        },
        /**
         * @member statusText
         * @summary headerset
         * @memberof headers
         * @description Gets or sets the status text (response only).
         * @example
         * headers.statusText = 'Test Message';
         * // => Result: Moovweb modifies the response to return a 'Test Message' status
         * //    text.
         * headers.statusText;
         * // => Returns: 'Test Message'
         */
        set statusText(val) {
            self.statusText = val;
        },
        header: this.header.bind(this),
        addHeader: this.addHeader.bind(this),
        headerKeys: this.headerKeys.bind(this),
        removeHeader: this.removeHeader.bind(this),
        removeCookie: this.removeCookie.bind(this),
        removeSetCookie: this.removeSetCookie.bind(this),
        removeAllHeaders: this.removeAllHeaders.bind(this),
        toString: this.toString.bind(this)
    };
}

/**
 * @method header
 * @summary headerset
 * @memberof headers
 * @description Accesses the value for the given header. If a second `val`
 * argument is supplied, then this adds a new header key-value pair, or
 * modifies it if it already exists.
 * @param {String} key A string for the header key.
 * @param {String} [val] A string for the header value.
 * @return {String|undefined} A string for the header value (getter), or
 * `undefined` (setter).
 * @example
 * headers.header('User-Agent');
 * // => Returns: A string for the User-Agent header value.
 * @example
 * headers.addHeader('X-New-Header-Key', 'New Header Value');
 * // => Result: New 'X-New-Header-Key' key-value pair.
 * @example
 * headers.header('User-Agent', env.user_agent + '/Moovweb');
 * // => Result: Updated User-Agent header.
 */
HeaderSet.prototype.header = function(key, val) {
    let k = key.toLowerCase();
    if (val) {
        if (k in this.hlookup) {
            this.fields[this.hlookup[k]][1] = val;
        } else {
            this.addHeader(key, val);
        }
    } else {
        return (this.fields[this.hlookup[k]] || [])[1];
    }
};

/**
 * @method addHeader
 * @summary headerset
 * @memberof headers
 * @description Adds a new header.
 * @param {String} key A string for the header key.
 * @param {String} val A string for the header value.
 * @return {undefined} `undefined`
 * @example
 * headers.addHeader('X-New-Header-Key', 'New Header Value');
 * // => Result: New 'X-New-Header-Key' key-value pair.
 */
HeaderSet.prototype.addHeader = function(key, val) {
    this.hlookup[key.toLowerCase()] = this.fields.length;
    this.fields.push([key, val]);
};

/**
 * @method headerKeys
 * @summary headerset
 * @memberof headers
 * @description Returns an array of header keys of all set headers.
 * @return {array} An array of header keys of all set headers.
 * @example
 * headers.addHeader("X-New-Header-Key", "New Header Value");
 * headers.headerKeys();
 * // => Returns: An array of keys that includes "X-New-Header-Key".
 */
HeaderSet.prototype.headerKeys = function() {
    return Object.keys(this.hlookup);
};

/**
 * @method removeCookie
 * @summary headerset
 * @memberof headers
 * @description Removes all Cookie headers matching the parameter.
 * @param {String} key The name of the Cookie to remove.
 * @return {Array} Array of cookie values removed.
 * @example
 * headers.removeCookie('device_type');
 * // => Result: Removes all Cookie headers for cookies name 'device_type'
 */
HeaderSet.prototype.removeCookie = function(cookieName) {
    let results = [];
    let preparedCookieName = cookieName.toLowerCase() + '=';

    for (let i = 0, len = this.fields.length; i &lt; len; i++) {
        let headerName = this.fields[i][0],
            headerValue = this.fields[i][1];

        // If there is a cookie header and the cookie contains the cookiename in it somewhere, parse the cookie
        if (headerName &amp;&amp; headerName.toLowerCase() === 'cookie' &amp;&amp; headerValue.toLowerCase().indexOf(preparedCookieName) >= 0) {
            let cookies = headerValue.split('; '),
                remainingCookies = [];
            for (let j = 0; j &lt; cookies.length; j++) {
                if (cookies[j].toLowerCase().indexOf(preparedCookieName) === 0) {

                    // push the cookie value into the result
                    results.push(cookies[j].substr(preparedCookieName.length));
                } else {
                    remainingCookies.push(cookies[j]);
                }
            }

            // Reassemble the remaining cookies back into a string.
            this.fields[i][1] = remainingCookies.join('; ');

            // If the cookie is empty, remove the whole cookie header
            let value = this.fields[i][1];
            if (!value || !value.length) {
                this.fields[i] = [];
            }
        }
    }
    return results;
};

/**
 * @method removeSetCookie
 * @summary headerset
 * @memberof headers
 * @description Removes all SetCookie headers matching the parameter.
 * @param {String} key The name of the SetCookie to remove.
 * @return {Array} Array of cookie values removed.
 * @example
 * headers.removeSetCookie('device_type');
 * // => Result: Removes all SetCookie headers for cookies name 'device_type'
 */
HeaderSet.prototype.removeSetCookie = function(cookieName) {
    let results = [],
        preparedCookieName = cookieName.toLowerCase();
    for (let i = 0, len = this.fields.length; i &lt; len; i++) {
        let headerName = this.fields[i][0];
        if (headerName &amp;&amp; headerName.toLowerCase() === 'set-cookie') {
            let value = this.fields[i][1];
            if (value) {
                let cookie = value.split('=');
                if (cookie[0].toLowerCase().trim() === preparedCookieName) {
                    results.push(cookie.slice(1).join('='));
                    this.fields[i] = [];
                }
            }
        }
    }
    return results;
};

/**
 * @method removeHeader
 * @summary headerset
 * @memberof headers
 * @description Removes the last matching header.
 * @param {String} key A string for the header key to remove.
 * @return {String} value of header removed.
 * @example
 * headers.removeHeader('Set-Cookie');
 * // => Result: Removes the last found Set-Cookie header.
 */
HeaderSet.prototype.removeHeader = function(key) {
    key = key.toLowerCase();
    let result,
        kv = this.fields[this.hlookup[key]];
    if (kv) {
        result = kv[1];
    }
    this.fields[this.hlookup[key]] = [];
    delete this.hlookup[key];
    return result;
};

/**
 * @method removeAllHeaders
 * @summary headerset
 * @memberof headers
 * @description Removes all headers matching a given key name.
 * @param {String} key A string for the header key to remove.
 * @return {Array} array of header values removed.
 * @example
 * headers.removeAllHeaders('Set-Cookie');
 * // => Result: Removes all Set-Cookie headers.
 */
HeaderSet.prototype.removeAllHeaders = function(key) {
    let results = [];
    key = key.toLowerCase();
    for (let i = 0, len = this.fields.length; i &lt; len; i++) {
        if (this.fields[i][0]) {
            let k = this.fields[i][0];
            if (k &amp;&amp; k.toLowerCase() === key) {
                results.push(this.fields[i][1]);
                this.fields[i] = [];
            }
        }
    }
    delete this.hlookup[key];
    return results;
};

// not defined in the global `headers` constructor (HeaderSet's fns).
HeaderSet.prototype.toString = function() {
    let raw;
    if (this.type === 'request') {
        raw = this.method + ' ' + this.path + ' HTTP/1.' + this.versionMinor;
    } else if (this.type === 'response') {
        raw = 'HTTP/1.' + this.versionMinor + ' ' + this.statusCode + ' ' + this.statusText;
    }
    for (let i = 0, len = this.fields.length; i &lt; len; i++) {
        if (this.fields[i][0]) {
            raw += '\r\n' + this.fields[i][0] + ': ' + this.fields[i][1];
        }
    }
    return raw;
};

/**
 * Define all the export points
 */
module.exports = HeaderSet;
</code></pre>
        </article>
    </section>





      <div class="timestamp">
          <i>Last updated Mon Feb 26 2018 22:51:29 GMT+0000 (UTC)</i>
      </div>
  </div>
</div>
</body>
