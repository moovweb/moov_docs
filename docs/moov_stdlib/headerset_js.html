<body>

<div data-section="accordion" id="content-nav">
  <section>
      <ul class="doc-sidebar" data-section-content data-section="accordion" id="content-sidebar"><section><a href="#" data-section-title>Classes</a><ul data-section-content data-section="accordion" ><section><a href="module_headerset_HeaderSet" class="" data-section-title>HeaderSet</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_headerset_HeaderSet#addHeader">addHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet#header">header</a></li><li data-type='method'><a href="module_headerset_HeaderSet#removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module_headerset_HeaderSet#removeHeader">removeHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet#toString">toString</a></li></ul></section></ul></section><section><a href="#" data-section-title>Modules</a><ul data-section-content data-section="accordion" ><section><a href="module_functions" class="" data-section-title>functions</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_functions#.absolutize">absolutize</a></li><li data-type='method'><a href="module_functions#.absolutizeSrcs">absolutizeSrcs</a></li><li data-type='method'><a href="module_functions#.activeLayers">activeLayers</a></li><li data-type='method'><a href="module_functions#.addAssets">addAssets</a></li><li data-type='method'><a href="module_functions#.addCanonicalTag">addCanonicalTag</a></li><li data-type='method'><a href="module_functions#.assert">assert</a></li><li data-type='method'><a href="module_functions#.asset">asset</a></li><li data-type='method'><a href="module_functions#.cleanMobileMetaTags">cleanMobileMetaTags</a></li><li data-type='method'><a href="module_functions#.getPageType">getPageType</a></li><li data-type='method'><a href="module_functions#.handleRobots">handleRobots</a></li><li data-type='method'><a href="module_functions#.insertDnsPrefetch">insertDnsPrefetch</a></li><li data-type='method'><a href="module_functions#.insertSubresource">insertSubresource</a></li><li data-type='method'><a href="module_functions#.isRobots">isRobots</a></li><li data-type='method'><a href="module_functions#.layer">layer</a></li><li data-type='method'><a href="module_functions#.layerNot">layerNot</a></li><li data-type='method'><a href="module_functions#.moveStylesAboveScripts">moveStylesAboveScripts</a></li><li data-type='method'><a href="module_functions#.moveStylesToHead">moveStylesToHead</a></li><li data-type='method'><a href="module_functions#.onDevelopment">onDevelopment</a></li><li data-type='method'><a href="module_functions#.perfectProxy">perfectProxy</a></li><li data-type='method'><a href="module_functions#.queryLayerText">queryLayerText</a></li><li data-type='method'><a href="module_functions#.relocateScripts">relocateScripts</a></li><li data-type='method'><a href="module_functions#.removeAllStyles">removeAllStyles</a></li><li data-type='method'><a href="module_functions#.removeDesktopJs">removeDesktopJs</a></li><li data-type='method'><a href="module_functions#.removeDesktopMobileIcon">removeDesktopMobileIcon</a></li><li data-type='method'><a href="module_functions#.removeHtmlComments">removeHtmlComments</a></li><li data-type='method'><a href="module_functions#.rewriteAspNetScripts">rewriteAspNetScripts</a></li><li data-type='method'><a href="module_functions#.rewriteJsSrcs">rewriteJsSrcs</a></li><li data-type='method'><a href="module_functions#.rewriteLink">rewriteLink</a></li><li data-type='method'><a href="module_functions#.rewriteLinks">rewriteLinks</a></li><li data-type='method'><a href="module_functions#.rewriteToProxy">rewriteToProxy</a></li><li data-type='method'><a href="module_functions#.sass">sass</a></li><li data-type='method'><a href="module_functions#.setPageType">setPageType</a></li><li data-type='method'><a href="module_functions#~gatherHosts">gatherHosts</a></li></ul></section><li><a href="module_headerset">headerset</a></li><li><a href="module_stdlib">stdlib</a></li></ul></section><section><a href="#" data-section-title>Namespaces</a><ul data-section-content data-section="accordion" ><section><a href="module_headerset_HeaderSet_fns" class="" data-section-title>fns</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_headerset_HeaderSet_fns#.addHeader">addHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.header">header</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.method">method</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.method">method</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.path">path</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.path">path</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.removeAllHeaders">removeAllHeaders</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.removeHeader">removeHeader</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusCode">statusCode</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusCode">statusCode</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusText">statusText</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.statusText">statusText</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.versionMinor">versionMinor</a></li><li data-type='method'><a href="module_headerset_HeaderSet_fns#.versionMinor">versionMinor</a></li></ul></section><section><a href="module_stdlib_stdlib" class="" data-section-title>stdlib</a><ul class='methods' data-section-content data-section='accordion'><li data-type='method'><a href="module_stdlib_stdlib#.addCookie">addCookie</a></li><li data-type='method'><a href="module_stdlib_stdlib#.export">export</a></li><li data-type='method'><a href="module_stdlib_stdlib#.init$">init$</a></li><li data-type='method'><a href="module_stdlib_stdlib#.scoped$">scoped$</a></li></ul></section></ul></section><section><a href="#" data-section-title>Global</a><ul data-section-content data-section="accordion"><li><a href="global#breakpoint">breakpoint</a></li><li><a href="global#env">env</a></li><li><a href="global#layers">layers</a></li><li><a href="global#rules">rules</a></li><li><a href="global#tag">tag</a></li><li><a href="global#txt">txt</a></li></ul></section></ul>
  </section>
</div>

<div id="main">
    
    <h1 class="page-title">headerset.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

/**
 * @module headerset
 */

const REQ_REGEX = /^([A-Z]+)\s+(.+)\s+HTTP\/1.([01])$/m;
const RES_REGEX = /^HTTP\/1.([01]) (\d{3}) ([^\n\r]+)$/m;

/**
 * @param {string} type "request" or "response".
 * @param {string} rawHeaders
 * @class
 */
function HeaderSet(type, rawHeaders) {
    this.type = type;
    this.fields = [];
    this.hlookup = {};
    let matches;
    if (type === "request") {
        matches = rawHeaders.match(REQ_REGEX);
        this.method = matches[1];
        this.path = matches[2];
        this.versionMinor = matches[3];
    } else if (type === "response") {
        matches = rawHeaders.match(RES_REGEX);
        this.versionMinor = matches[1];
        this.statusCode = matches[2];
        this.statusText = matches[3];
    }

    let headerExp = /^([^:\s]*): *(.*)$/mg; // local since it contains unique state
    headerExp.lastIndex = matches[0].length;
    while ((matches = headerExp.exec(rawHeaders))) {
        this.hlookup[matches[1].toLowerCase()] = this.fields.length;
        this.fields.push([matches[1], matches[2]]);
    }

    let self = this;

    /**
     * @namespace
     */
    this.fns = {
        /**
         * Get method.
         * @function
         * @returns {string} Return self.method.
         */
        get method() {
            return self.method;
        },
        /**
         * Get path.
         * @function
         * @returns {string} Return self.path.
         */
        get path() {
            return self.path;
        },
        /**
         * Get versionMinor.
         * @function
         * @returns {string} Return self.versionMinor.
         */
        get versionMinor() {
            return self.versionMinor;
        },
        /**
         * Get statusCode.
         * @function
         * @returns {string} Return self.statusCode.
         */
        get statusCode() {
            return self.statusCode;
        },
        /**
         * Get statusText.
         * @function
         * @return {string} Return self.statusText.
         */
        get statusText() {
            return self.statusText;
        },
        /**
         * Set method(val).
         * @function
         * @param {string} val Method.
         */
        set method(val) {
            self.method = val;
        },
        /**
         * Set path(val).
         * @function
         * @param {string} val Path.
         */
        set path(val) {
            self.path = val;
        },
        /**
         * Set versionMinor(val).
         * @function
         * @param {string} val VersionMinor.
         */
        set versionMinor(val) {
            self.versionMinor = val;
        },
        /**
         * Set statusCode(val).
         * @function
         * @param {string} val StatusCode.
         */
        set statusCode(val) {
            self.statusCode = val;
        },
        /**
         * Set statusText(val).
         * @function
         * @param {string} val StatusText.
         */
        set statusText(val) {
            self.statusText = val;
        },

        /**
         * Bind header function.
         * @function
         */
        header: this.header.bind(this),
        /**
         * Bind addHeader function.
         * @function
         */
        addHeader: this.addHeader.bind(this),
        /**
         * Bind removeHeader function.
         * @function
         */
        removeHeader: this.removeHeader.bind(this),
        /**
         * Bind removeAllHeaders function.
         * @function
         */
        removeAllHeaders: this.removeAllHeaders.bind(this)
    };
}
// set or replace existing header
/**
 * Set or replace existing header.
 * @param {string} key Header key.
 * @param {string} val Header value.
 */
HeaderSet.prototype.header = function(key, val) {
    let k = key.toLowerCase();
    if (val) {
        if (k in this.hlookup) {
            this.fields[this.hlookup[k]][1] = val;
        } else {
            this.addHeader(key, val);
        }
    } else {
        return (this.fields[this.hlookup[k]] || [])[1];
    }
};
// append header
/**
 * Append header.
 * @param {string} key Header key.
 * @param {string} val Header value.
 */
HeaderSet.prototype.addHeader = function(key, val) {
    this.hlookup[key.toLowerCase()] = this.fields.length;
    this.fields.push([key, val]);
};
// remove last matching header
/**
 * Remove last matching header.
 * @param {string} key Header key.
 */
HeaderSet.prototype.removeHeader = function(key) {
    key = key.toLowerCase();
    this.fields[this.hlookup[key]] = [];
    delete this.hlookup[key];
};
// remove all matching headers
/**
 * Remove all matching header.
 * @param {string} key Header key.
 */
HeaderSet.prototype.removeAllHeaders = function(key) {
    key = key.toLowerCase();
    for (let i = 0, len = this.fields.length; i &lt; len; i++) {
        if (this.fields[i][0]) {
            let k = this.fields[i][0];
            if (k &amp;&amp; k.toLowerCase() === key) {
                this.fields[i] = [];
            }
        }
    }
    delete this.hlookup[key];
};
/**
 * Print headers as a string.
 * @returns {string} Print headers .
 */
HeaderSet.prototype.toString = function() {
    let raw;
    if (this.type === "request") {
        raw = this.method + " " + this.path + " HTTP/1." + this.versionMinor;
    } else if (this.type === "response") {
        raw = "HTTP/1." + this.versionMinor + " " + this.statusCode + " " + this.statusText;
    }
    for (let i = 0, len = this.fields.length; i &lt; len; i++) {
        if (this.fields[i][0]) {
            raw += "\r\n" + this.fields[i][0] + ": " + this.fields[i][1];
        }
    }
    return raw;
};

// Define all the export points
/**
 * Define all the export points
 */
module.exports = HeaderSet;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Thu Oct 15 2015 23:24:39 GMT+0000 (UTC)
</footer>

<script>prettyPrint();</script>
</body>
